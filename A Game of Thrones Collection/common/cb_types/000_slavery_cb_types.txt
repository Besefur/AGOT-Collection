slave_raid = {
	name = CB_NAME_SLAVE_RAID
	war_name = WAR_NAME_SLAVE_RAID
	sprite = 7
	truce_days = 3650
	hostile_against_others = yes
	can_ask_to_join_war = no
	attacker_can_call_allies = no
	is_permanent = yes
	#check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	allowed_to_target_tributaries = no
	att_ticking_war_score_multiplier = 5.0
	def_ticking_war_score_multiplier = 5.0
	defender_unoccupied_warscore = yes
	max_attacker_battle_score = 90
	capturing_defender_is_complete_victory = no

	allow_distant = yes # AI parameter

	infamy_modifier = 0

	sort_priority = 3500

	can_use_gui = {
		ROOT = {
			# One of the following must be true:
			#	The target borders the attacker's realm/demesne
			#	The attacker is a slave trader whose capital is a port
			#	Added Trait requirements to reduce the amount of raids
			OR = {
				AND = {
					trait = ambitious
					martial = 10
					OR = {
						trait = cruel
						trait = wroth
						trait = greedy
						trait = lustful
					}
					NOR = {
						trait = kind
						trait = craven
						trait = just
					}
				}
				trait = pirate
				ai = no
			}
			OR = {
				custom_tooltip = {
					text = TOOLTIPslave_raidBORDER
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								owner = {
									OR = {
										character = FROM
										is_liege_or_above = FROM
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										owner = {
											OR = {
												character = FROM
												is_liege_or_above = FROM
											}
										}
									}
								}
							}
						}
					}
				}
				AND = {
					capital_scope = { port = yes }
					trait = slave_trader
				}
			}
			custom_tooltip = { # Cannot use against same-culture-group provinces
				text = TOOLTIPslave_raidCULTURE
				FROM = { NOT = { culture_group = ROOT } }
			}
			custom_tooltip = { # Must not already be sacked
				text = TOOLTIPslave_raidSACKED
				FROM = { capital_scope = { NOT = { has_province_modifier = sacked } } }
			}
			custom_tooltip = { # Cannot use this within the same realm if crown authority is high
				text = TOOLTIPslave_raidCENTRALIZATION
				hidden_tooltip = {
					OR = {
						NOT = { same_realm = FROM }
						crownlaw_title = {
							OR = {
								has_law = centralization_0
								has_law = centralization_1
							}
						}
					}
				}
			}
			custom_tooltip = {
				text = TOOLTIPslave_raidPIRATE
				hidden_tooltip = {
					FROM = {
						OR = {
							NOT = { trait = pirate }
							higher_tier_than = DUKE
						}
					}
				}
			}
		}
	}

	can_use = {
		universal_cb_restrictions_trigger = yes
		ROOT = {
			OR = {
				has_full_slavery_trigger = yes
				crownlaw_title = { has_law = slavery_3	}
				AND = { #if no crown law title, top liege has legal slavery
					NOT = { crownlaw_title = { always = yes } }
					top_liege = {
						OR = {
							has_full_slavery_trigger = yes
							crownlaw_title = { has_law = slavery_3	}
						}
					}
				}
			}
			NOT = { trait = liberator }

			#These characters can gain slaves by looting
			is_allowed_to_loot = no

			NOT = { is_nomadic = yes }
			NOT = { has_game_rule = { name = slavery value = off } }
		}
		FROM = {
			higher_tier_than = BARON
			demesne_size = 1
		}
	}

	is_valid = {
		universal_cb_valid_restrictions_trigger = yes
		ROOT = {
			OR = {
				has_full_slavery_trigger = yes
				crownlaw_title = { has_law = slavery_3	}
				AND = { #if no crown law title, top liege has legal slavery
					NOT = { crownlaw_title = { always = yes } }
					top_liege = {
						OR = {
							has_full_slavery_trigger = yes
							crownlaw_title = { has_law = slavery_3	}
						}
					}
				}
			}
			NOT = { trait = liberator }
		}

		# Cannot use this within the same realm if crown authority is high
		ROOT = {
			OR = {
				NOT = { same_realm = FROM }
				crownlaw_title = {
					OR = {
						has_law = centralization_0
						has_law = centralization_1
					}
				}
			}
		}
	}

	on_add = {
		e_rebels = {
			persistent_event_target:chronicle_player = {
				if = {
					limit = { character = ROOT }
					chronicle = {
						entry = CHRONICLE_WAR_SLAVE_RAID_ATTACKER
						portrait = [From.GetID]
					}
					break = yes
				}
				if = {
					limit = { character = FROM }
					chronicle = {
						entry = CHRONICLE_WAR_SLAVE_RAID_DEFENDER
						portrait = [Root.GetID]
					}
					break = yes
				}
				if = {
					limit = { is_liege_or_above = ROOT }
					chronicle = {
						entry = CHRONICLE_WAR_SLAVE_RAID_ATTACKER_LIEGE
						portrait = [Root.GetID]
					}
					break = yes
				}
				if = {
					limit = { is_liege_or_above = FROM }
					chronicle = {
						entry = CHRONICLE_WAR_SLAVE_RAID_DEFENDER_LIEGE
						portrait = [From.GetID]
					}
				}
			}
		}
		ROOT = { #Some characters unhappy
			if = {
				limit = {
					OR = {
						has_antislavery_religion_trigger = yes
						has_antislavery_culture_trigger = yes
					}
				}
				character_event = { id = slavery.760 days = 1 tooltip = TOOLTIPslavery.760 }
			}
		}
	}

	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		# Sack a random occupied province
		FROM = {
			# Auto-enslave all prisoners of war
			any_realm_character = {
				limit = {
					prisoner = yes
					host = { character = ROOT }
					is_liege_or_above = ROOT_FROM
					NOT = { trait = slave }
					is_ruler = no
				}
				add_trait = slave
				hidden_tooltip = {
					prisoner = no
					clr_character_flag = captured_in_battle
					clr_character_flag = lost_trial_by_combat
					clr_character_flag = imprisoned_for_relatives_crimes
					ROOT = { reverse_banish = PREV }
					#give_minor_title = title_slave
					opinion = { who = ROOT modifier = opinion_my_owner }
					reverse_opinion = { who = ROOT modifier = opinion_my_slave }
					opinion = { who = ROOT modifier = opinion_enslaved_me }
				}
			}
			capital_scope = { #try capital first
				if = {
					limit = {
						is_occupied = yes
						NOT = { has_province_modifier = sacked }
						any_province_holding = {
							controller = {
								OR = {
									character = ROOT
									is_liege_or_above = ROOT
									AND = {
										lower_tier_than = ROOT
										has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege }
									}
								}
							}
							NOT = { holding_type = trade_post }
						}
					}
					add_province_modifier = {
						name = sacked
						duration = 1825
					}
					ROOT = { character_event = { id = slavery.1000 tooltip = "EVTTOOLTIPSLAVERY1000" } } # The attacker gains a slave camp level
					slave_raid_gain_slaves_effect = yes
					break = yes
				}
			}
			if = {
				limit = {
					NOT = {
						capital_scope = {
							is_occupied = yes
							NOT = { has_province_modifier = sacked }
							any_province_holding = {
								controller = {
									OR = {
										character = ROOT
										is_liege_or_above = ROOT
										AND = {
											lower_tier_than = ROOT
											has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege }
										}
									}
								}
								NOT = { holding_type = trade_post }
							}
						}
					}
				}
				random_realm_province = {
					limit = {
						is_occupied = yes
						any_province_holding = {
							controller = {
								OR = {
									character = ROOT
									is_liege_or_above = ROOT
									AND = {
										lower_tier_than = ROOT
										has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege }
									}
								}
							}
							NOT = { holding_type = trade_post }
						}
					}
					add_province_modifier = {
						name = sacked
						duration = 1825
					}
					ROOT = { character_event = { id = slavery.1000 tooltip = "EVTTOOLTIPSLAVERY1000" } } # The attacker gains a slave camp level
					slave_raid_gain_slaves_effect = yes
					break = yes
				}
			}
			if = {
				limit = {
					NOT = {
						any_realm_province = {
							is_occupied = yes
							any_province_holding = {
								controller = {
									OR = {
										character = ROOT
										is_liege_or_above = ROOT
										AND = {
											lower_tier_than = ROOT
											has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege }
										}
									}
								}
								NOT = { holding_type = trade_post }
							}
						}
					}
				}
				custom_tooltip = { #backup tooltip
					text = TOOLTIPslave_raidSACKTOOLTIP
				}
			}
		}
	}

	on_fail = {
		# Auto-enslave all prisoners of war
		FROM = {
			any_realm_character = {
				limit = {
					prisoner = yes
					host = { character = ROOT }
					is_liege_or_above = ROOT_FROM
					NOT = { trait = slave }
				}
				add_trait = slave
				hidden_tooltip = {
					prisoner = no
					clr_character_flag = captured_in_battle
					clr_character_flag = lost_trial_by_combat
					clr_character_flag = imprisoned_for_relatives_crimes
					ROOT = { reverse_banish = PREV }
					#give_minor_title = title_slave
					opinion = { who = ROOT modifier = opinion_my_owner }
					reverse_opinion = { who = ROOT modifier = opinion_my_slave }
					opinion = { who = ROOT modifier = opinion_enslaved_me }
				}
			}
		}
		ROOT = { prestige = -100 }
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		# Free all prisoners
		FROM = {
			any_realm_character = {
				limit = {
					is_liege_or_above = ROOT_FROM
					prisoner = yes
					host = { character = ROOT }
				}
				prisoner = no
				clr_character_flag = captured_in_battle
				clr_character_flag = lost_trial_by_combat
				clr_character_flag = imprisoned_for_relatives_crimes
			}
		}
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 3.0
			}
			# Free and repatriate all slaves that are:
			#	- of the defender's culture group
			#	- of the defender's dynasty/family
			#	- of the defender's spouse's dynasty/family
			#	- defender's friend
			any_courtier = {
				limit = {
					trait = slave
					has_opinion_modifier = { who = ROOT modifier = opinion_my_owner }
					OR = {
						culture_group = ROOT_FROM
						dynasty = ROOT_FROM
						ROOT_FROM = { any_spouse = { dynasty = PREVPREV } }
						is_close_relative = ROOT_FROM
						ROOT_FROM = { any_spouse = { is_close_relative = PREVPREV } }
						is_friend = ROOT_FROM
					}
				}
				character_event = { id = slavery.0 tooltip = "EVTTOOLTIPSLAVERY0" }
				hidden_tooltip = { move_character = ROOT_FROM }
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = 10
		modifier = {
			factor = 20
			FROM = {
				NOT = {
					any_realm_province = {
						is_occupied = yes
						any_province_holding = {
							controller = {
								OR = {
									character = ROOT
									is_liege_or_above = ROOT
									AND = {
										lower_tier_than = ROOT
										has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege }
									}
								}
							}
							NOT = { holding_type = trade_post }
						}
					}
				}
			}
		}
	}
	attacker_ai_defeat_worth = {
		factor = 80
	}
	defender_ai_victory_worth = {
		factor = -1 # Always accept
	}
	defender_ai_defeat_worth = {
		factor = 80
	}

	ai_will_do = { #Also apply AI logic to event  slavery.2500
		factor = 0.75 #Other CBs take priority

		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { can_use_dragon_abilities_trigger = yes } }
			FROM = {
				can_use_dragon_abilities_trigger = yes
				is_incapable = no
			}
		}
		modifier = {
			factor = 0
			ROOT = {
				NOT = { can_use_dragon_abilities_trigger = yes }
				NOT = {
					relative_power = {
						who = FROM
						power = 6
					}
				}
			}
			FROM = {
				can_use_dragon_abilities_trigger = yes
				is_incapable = no
			}
		}
		#Camps are full
		modifier = {
			factor = 0
			ROOT = {
				OR = {
					capital_holding = {
						OR = {
							has_building = ca_asoiaf_slavepit_5
							has_building = ct_asoiaf_slavepit_5
							has_building = tp_asoiaf_slavepit_5
						}
					}
					family_palace = { has_building = fp_asoiaf_slavepit_5 }
				}
			}
		}
		#More cautious against nomads
		modifier = {
			factor = 0
			ROOT = {
				NOT = { is_nomadic = yes }
				NOT = {
					relative_power = {
						who = FROM
						power = 4
					}
				}
			}
			FROM = { is_nomadic = yes }
		}
		#United nomads go for invasions
		modifier = {
			factor = 0
			ROOT = {
				is_nomadic = yes
				independent = yes
				OR = {
					has_character_modifier = greatest_of_khans
					has_character_modifier = jhattar_of_jogos_nhai
				}
			}
		}
		#Anti-Slavery will usually not do this
		modifier = {
			factor = 0
			ROOT = {
				OR = {
					has_antislavery_religion_trigger = yes
					has_antislavery_culture_trigger = yes
				}
				OR = {
					trait = zealous
					trait = honorable
					trait = kind
					AND = {
						NOT = { trait = arbitrary }
						NOT = { trait = ruthless }
						NOT = { trait = lunatic }
					}
				}
			}
		}
		modifier = {
			factor = 0
			ROOT = { trait = liberator }
		}
		#Emperor's with many king vassals wont do this to avoid mega wars
		modifier = {
			factor = 0
			ROOT = {
				tier = EMPEROR
				any_vassal = {
					count = 2
					tier = KING
				}
			}
		}
	}
}
slave_revolt = {
	name = CB_NAME_SLAVE_REVOLT
	war_name = WAR_NAME_SLAVE_REVOLT
	sprite = 16
	truce_days = 365
	hostile_against_others = yes
	is_permanent = no
	# check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	check_de_jure_tier = KING # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	press_claim = yes
	can_ask_to_join_war = no
	is_independence = yes

	infamy_modifier = 0

	can_use = {
		ROOT = { has_character_flag = slave_rebel }
	}

	can_use_title = {
		tier = king
		OR = {
			has_holder = no
			holder_scope = {
				OR = {
					same_realm = FROM
					character = FROM
				}
			}
		}
	}

	is_valid_title = {
		OR = {
			has_holder = no
			holder_scope = {
				OR = {
					same_realm = FROM
					character = FROM
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = 1000
			hidden_tooltip = {
				#occupy_minors_of_occupied_settlements = FROM
				gain_all_occupied_titles = FROM
			}
			clr_character_flag = slave_rebel
			set_dynasty_flag = liberator_dynasty #give dynasty flag stopping them re-legalising slavery ASAP
		}
		FROM = {
			prestige = -500
			change_variable = { which = fear_actions value = -20 }
		}
	}

	on_success_title = {
		custom_tooltip = {
			text = tribal_invasion_succ_tip
			usurp_title = { target = ROOT type = revolt }
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title = {
						title = PREV
						enemy = FROM
					}
					if = {
						limit = { has_nickname = no }
						random_list = {
							10 = { give_nickname = nick_the_liberator }
							10 = { give_nickname = nick_the_emancipator }
							10 = { give_nickname = nick_the_saviour }
							10 = { give_nickname = nick_the_champion_of_kingdom }
							10 = { give_nickname = nick_the_victorious }
							10 = { give_nickname = nick_the_triumphant }
							10 = { give_nickname = nick_the_breaker_of_chains }
							10 = { give_nickname = nick_the_deliverer }
							10 = {
								if = {
									limit = { is_female = yes }
									give_nickname = nick_mother
								}
								if = {
									limit = { is_female = no }
									give_nickname = nick_father
								}
							}
							20 = { }
						}
					}
				}
			}
		}
		add_law = slavery_0
		hidden_tooltip = {
			add_law = treaty_breach_1
			ROOT = {
				any_realm_province = {
					limit = { has_province_modifier = slave_revolt_modifier }
					remove_province_modifier = slave_revolt_modifier
				}
				character_event = { id = maintenance.34 days = 2 } #refill holding levies
			}
		}
		hidden_tooltip = {
			ROOT = {
				any_demesne_title = {
					limit = {
						NOT = { tier = BARON }
						NOT = { tier = EMPEROR }
					}
					set_variable = { which = "de_facto_empire" value = 0 }
				}
				any_realm_lord = {
					any_demesne_title = {
						limit = {
							NOT = { tier = BARON }
							NOT = { tier = EMPEROR }
						}
						set_variable = { which = "de_facto_empire" value = 0 }
					}
				}
				if = { #Make sure demesne size is at least 1
					limit = { NOT = { demesne_size = 1 } }
					random_vassal = {
						limit = {	tier = COUNT }
						random_demesne_title = {
							limit = { tier = COUNT }
							usurp_title = { target = ROOT type = invasion }
						}
					}
				}
				if = { #Make sure new realm is feudal
					limit = { NOT = { government = feudal_government } }
					family_palace = { destroy_settlement = THIS }
					set_government_type = feudal_government
					random_vassal = {
						limit = {
							any_demesne_title = {
								tier = BARON
								holding_type = castle
								location = { ROOT = { capital_scope = { province_id = PREVPREV } } }
							}
						}
						random_demesne_title = {
							limit = {
								tier = BARON
								holding_type = castle
								location = { ROOT = { capital_scope = { province_id = PREVPREV } } }
							}
							usurp_title = { target = ROOT type = invasion }
							province_capital = yes
							ROOT = { capital = PREV }
						}
					}
				}
			}
			FROM = {
				if = {
					limit = { is_liege_or_above = ROOT }
					character_event = { id = maintenance.25 } #Subjugation flag maintenance
				}
			}
		}
#		if = {
#			limit = { ROOT = { is_landed = no } }
#			FROM = {
#				random_realm_province = {
#					limit = {
#						culture = ROOT
#						kingdom = {
#							title = PREVPREVPREV
#						}
#					}
#					county = {
#						usurp_title = ROOT
#					}
#				}
#			}
#		}
#		grant_title = ROOT

	}

	on_fail_title = {
		FROM = {
			# Random chance of regaining slave camp level
			if = {
				limit = { crownlaw_title = { has_law = slavery_2 } }
				random = {
					chance = 40
					custom_tooltip = {
						text = TOOLTIPSLAVEREVOLTX
						hidden_tooltip = {
							if = {
								limit = { capital_scope = { has_province_flag = slave_revolt } }
								character_event = { id = slavery.1000 }
								if = {
									limit = { is_merchant_republic = yes }
									any_vassal = {
										limit = { is_patrician = yes }
										character_event = { id = slavery.1000 }
									}
								}
							}
							any_realm_lord = {
								limit = { capital_scope = { has_province_flag = slave_revolt } }
								character_event = { id = slavery.1000 }
							}
						}
					}
				}
			}
			prestige = 100
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor
					who = ROOT
					months = 1200
				}
			}
		}
		ROOT = {
			imprison = FROM
			clr_character_flag = captured_in_battle
			clr_character_flag = slave_rebel
			hidden_tooltip = {
				add_character_modifier = {
					name = broken_spirit
					days = -1
				}
				remove_trait = inspiring_leader
			}
		}
		hidden_tooltip = {
			FROM = {
				any_realm_province = {
					limit = { has_province_modifier = slave_revolt_modifier }
					remove_province_modifier = slave_revolt_modifier
					clr_province_flag = slave_revolt
				}
			}
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		FROM = {
			# Random chance of regaining slave camp level
			if = {
				limit = { crownlaw_title = { has_law = slavery_2 } }
				random = {
					chance = 80
					custom_tooltip = {
						text = TOOLTIPSLAVEREVOLTX
						hidden_tooltip = {
							if = {
								limit = { capital_scope = { has_province_flag = slave_revolt } }
								character_event = { id = slavery.1000 }
								if = {
									limit = { is_merchant_republic = yes }
									any_vassal = {
										limit = { is_patrician = yes }
										character_event = { id = slavery.1000 }
									}
								}
							}
							any_realm_lord = {
								limit = { capital_scope = { has_province_flag = slave_revolt } }
								character_event = { id = slavery.1000 }
							}
						}
					}
				}
			}
			prestige = 200
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor
					who = ROOT
					months = 1200
				}
			}
		}
		ROOT = {
			imprison = FROM
			clr_character_flag = captured_in_battle
			clr_character_flag = slave_rebel
			hidden_tooltip = {
				add_character_modifier = {
					name = broken_spirit
					days = -1
				}
				remove_trait = inspiring_leader
			}
		}
		hidden_tooltip = {
			FROM = {
				any_realm_province = {
					limit = { has_province_modifier = slave_revolt_modifier }
					remove_province_modifier = slave_revolt_modifier
					clr_province_flag = slave_revolt
				}
				any_realm_province = {
					limit = {
						OR = {
							has_province_modifier = slave_modifier_1
							has_province_modifier = slave_modifier_2
							has_province_modifier = slave_modifier_3
							has_province_modifier = slave_modifier_4
							has_province_modifier = slave_modifier_5
						}
					}
					add_province_modifier = {
						name = crushed_slave_revolt_1
						duration = 3650
					}
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = 75
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}
}
war_of_liberation = {
	name = CB_NAME_LIBERATION
	war_name = WAR_NAME_LIBERATION
	sprite = 28
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	defender_unoccupied_warscore = yes

	infamy_modifier = 0

	sort_priority = 7000

	can_use_gui = {
		ROOT = {
			is_incapable = no
			OR = { #Must either be liberator, or target broke anti-slavery treaty #or have doctrine/piety
				trait = liberator
				FROM = { primary_title = { has_law = treaty_breach_0 } }
				AND = {
					OR = {
						has_religion_feature = religion_feature_anti_slavery
						has_religion_feature = religion_feature_moonsingers
						has_religion_feature = religion_feature_rhoynar_pagan
					}
					piety = 100
					trait = zealous
				}
			}
			trigger_if = {
				limit = {
					NAND = {
						OR = {
							has_religion_feature = religion_feature_anti_slavery
							has_religion_feature = religion_feature_moonsingers
							has_religion_feature = religion_feature_rhoynar_pagan
						}
						piety = 100
						trait = zealous
					}
				}
				OR = { #Must either...
					culture_group = FROM #be same culture
					custom_tooltip = {
						text = TOOLTIPwar_of_liberationWESTEROS
						hidden_tooltip = { #both be on Westeros
							capital_scope = { region = world_westeros }
							FROM = { capital_scope = { region = world_westeros } }
						}
					}
					custom_tooltip = { #Neighbour target
						text = TOOLTIPwar_of_liberationNEIGHBOUR
						hidden_tooltip = {
							any_realm_province = {
								any_neighbor_province = {
									OR = {
										owner = { same_realm = FROM }
										AND = {
											is_land = no
											any_neighbor_province = {
												owner = { same_realm = FROM }
											}
										}
									}
								}
							}
						}
					}
					hidden_tooltip = { #landless player
						AND = {
							ai = no
							NOT = { demesne_size = 1 }
							primary_title = { is_landless_type_title = yes }
							war = no
						}
					}
					hidden_tooltip = { #Dany Quest
						AND = {
							character = 77041
							has_character_flag = liberation_of_meereen
							FROM = { has_landed_title = k_meereen }
						}
					}
				}
			}
		}
		FROM = { NOT = { is_nomadic = yes } }
	}

	can_use_title = {
		universal_cb_restrictions_trigger = yes
		ROOT = {
			NOT = { has_game_rule = { name = slavery value = off } }
		}
		ROOT = {
			OR = {
				primary_title = { has_law = slavery_0 }
				lower_tier_than = KING
			}
			OR = { #Cannot use during this part of dany quest
				NOT = { has_global_flag = enslavement_of_astapor }
				NOT = { character = 77041 }
			}
		}
		FROM = {
			has_landed_title = PREV
		}
		OR = { #Must either be liberator, or target broke anti-slavery treaty #or have doctrine/piety
			ROOT = { trait = liberator }
			FROM = { primary_title = { has_law = treaty_breach_0 } }
			ROOT = {
				OR = {
					has_religion_feature = religion_feature_anti_slavery
					has_religion_feature = religion_feature_moonsingers
					has_religion_feature = religion_feature_rhoynar_pagan
				}
			}
		}
		is_primary_holder_title = yes
		OR = {
			AND = {
				higher_tier_than = DUKE
				has_law = slavery_2
			}
			holder_scope = { #Can target independent slavers with no crown law
				NOT = { crownlaw_title = { always = yes } }
				independent = yes
				NOT = { trait = nightswatch }
				OR = {
					has_slavery_culture_trigger = yes
					has_slavery_religion_trigger = yes
				}
			}
		}
		OR = {
			tier = EMPEROR
			NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
		}
	}

	is_valid_title = {
		universal_cb_valid_restrictions_trigger = yes
		ROOT = {
			OR = {
				any_demesne_title = { has_law = slavery_0 }
				lower_tier_than = KING
				trait = liberator
			}
		}
		FROM = {
			has_landed_title = PREV
		}
	}

	on_add_title = {
		ROOT = {
			if = {
				limit = {
					NOR = {
						trait = liberator
						FROM = { primary_title = { has_law = treaty_breach_0 } }
					}
				}
				piety = -100
			}
		}
		hidden_tooltip = {
			FROM = {
				add_character_modifier = { name = defending_anti_slavery_war days = 30 hidden = yes }
				character_event = { id = diplomatic.3099 } #call for aid?
			}
		}
		e_rebels = {
			persistent_event_target:chronicle_player = {
				if = {
					limit = { character = ROOT }
					chronicle = {
						entry = CHRONICLE_WAR_LIBERATION_ATTACKER
						portrait = [From.GetID]
					}
					break = yes
				}
				if = {
					limit = { character = FROM }
					chronicle = {
						entry = CHRONICLE_WAR_LIBERATION_DEFENDER
						portrait = [Root.GetID]
					}
					break = yes
				}
				if = {
					limit = { is_liege_or_above = ROOT }
					chronicle = {
						entry = CHRONICLE_WAR_LIBERATION_ATTACKER_LIEGE
						portrait = [Root.GetID]
					}
					break = yes
				}
				if = {
					limit = { is_liege_or_above = FROM }
					chronicle = {
						entry = CHRONICLE_WAR_LIBERATION_DEFENDER_LIEGE
						portrait = [From.GetID]
					}
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		hidden_tooltip = {
			mega_war_rebel_leader_resolution_effect = yes
			FROM = {
				remove_trait = rebel_leader
			}
		}
		ROOT = {
			prestige = 200
			if = {
				limit = { has_antislavery_religion_trigger = yes }
				religion_authority = {
					modifier = liberated_realm
				}
			}
			hidden_tooltip = {
				if = {
					limit = { has_nickname = no }
					random_list = {
						10 = { give_nickname = nick_the_liberator }
						10 = { give_nickname = nick_the_emancipator }
						10 = { give_nickname = nick_the_saviour }
						10 = { give_nickname = nick_the_champion_of_kingdom }
						10 = { give_nickname = nick_the_victorious }
						10 = { give_nickname = nick_the_triumphant }
						10 = { give_nickname = nick_the_breaker_of_chains }
						10 = { give_nickname = nick_the_deliverer }
						10 = {
							if = {
								limit = { is_female = yes }
								give_nickname = nick_mother
							}
							if = {
								limit = { is_female = no }
								give_nickname = nick_father
							}
						}
						100 = { }
					}
				}
			}
		}
		ROOT = {
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}

		hidden_tooltip = {
			ROOT = {
				occupy_minors_of_occupied_settlements = FROM
				gain_all_occupied_titles = FROM
			}
		}

		FROM = {
			prestige = -400
			if = {
				limit = { has_slavery_religion_trigger = yes }
				piety = -200
				religion_authority = {
					modifier = liberated_realm_lost
				}
			}
		}
		###Special Dany Quest Events
		hidden_tooltip = {
			ROOT = {
				if = {
					limit = { character = 77041 }
					if = {
						limit = { has_character_flag = liberation_of_meereen }
						b_greatpyramidmeereen = { usurp_title = { target = ROOT type = invasion } }
						c_meereen = { usurp_title = { target = ROOT type = invasion } }
						b_greatpyramidmeereen = { province_capital = yes }
						narrative_event = { id = feast_for_crows.50 }
					}
					if = {
						limit = { has_character_flag = dany_liberation_quest }
						narrative_event = { id = feast_for_crows.57 days = 1 }
						narrative_event = { id = feast_for_crows.58 days = 1 }
					}
				}
			}
		}
	}

	on_success_title = {
		holder_scope = { save_event_target_as = old_usurped_title_holder }
		custom_tooltip = {
			text = invasion_succ_tip
			hidden_tooltip = {
				holder_scope = {
					if = {
						limit = { government = alliance_government } #disband alliance
						set_character_flag = conquest
						character_event = { id = free_cities.15 tooltip = TOOLTIPfree_cities.15 }
					}
				}
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
				FROM = {
					any_demesne_title = {
						limit = {
							tier = PREVPREV
							NOT = { title = PREVPREV }
						}
						usurp_title = { target = ROOT type = invasion }
						if = {
							limit = {
								higher_tier_than = DUKE
								NOT = { has_game_rule = { name = slavery value = off } }
							}
							ROOT = { set_character_flag = flag_slavery_treaty_breach }
							add_law = slavery_0
							add_law = treaty_breach_1
						}
					}
					set_defacto_liege = ROOT
				}
			}
		}
		hidden_tooltip = {
			if = {
				limit = {
					FROM = { is_liege_or_above = ROOT }
				}
				FROM = { imprison = ROOT clr_character_flag = captured_in_battle }
				FROM = { character_event = { id = maintenance.25 } }#Subjugation flag maintenance
			}
		}
		if = {
			limit = { NOT = { has_game_rule = { name = slavery value = off } } }
			if = {
				limit = { lower_tier_than = DUKE }
				set_title_flag = flag_slavery_treaty_breach
			}
			if = {
				limit = { higher_tier_than = DUKE }
				ROOT = { set_character_flag = flag_slavery_treaty_breach }
				add_law = slavery_0
			}
			hidden_tooltip = {
				if = {
					limit = { higher_tier_than = DUKE }
					add_law = treaty_breach_1
				}
				FROM = {
					any_demesne_title = {
						limit = {
							higher_tier_than = DUKE
							NOT = { has_law = slavery_0 }
						}
						add_law = slavery_0
					}
					any_vassal = {
						any_demesne_title = {
							limit = {
								higher_tier_than = DUKE
								NOT = { has_law = slavery_0 }
							}
							add_law = slavery_0
						}
					}
				}
			}
		}
		hidden_tooltip = {
			ROOT = {
				character_event = { id = maintenance.24 } #Mega war flag maintenance
				character_event = { id = maintenance.21 } #Take dejure vassals (AGOT)
			}
			if = {
				limit = { title = e_iron_throne } #Lose crownlands
				holder_scope = { character_event = { id = maintenance.37 } }
			}
		}
		clear_event_target = old_usurped_title_holder
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		###Special Dany Quest Events
		hidden_tooltip = {
			ROOT = {
				if = {
					limit = { character = 77041 }
					if = {
						limit = { has_character_flag = liberation_of_meereen }
						character_event = { id = clash_of_kings.58 days = 1 }
					}
					if = {
						limit = { has_character_flag = dany_liberation_quest }
						narrative_event = { id = feast_for_crows.57 days = 1 }
						narrative_event = { id = feast_for_crows.58 days = 1 }
					}
				}
			}
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			if = {
				limit = { has_slavery_religion_trigger = yes }
				piety = -100
				religion_authority = {
					modifier = lost_holy_war
					years = 20
				}
			}
			###Special Dany Quest Events
			if = {
				limit = { character = 77041 }
				if = {
					limit = { has_character_flag = liberation_of_meereen }
					imprison = FROM
					clr_character_flag = captured_in_battle
					hidden_tooltip = { character_event = { id = clash_of_kings.58 days = 1 } }
				}
				if = {
					limit = { has_character_flag = dany_liberation_quest }
					character_event = { id = feast_for_crows.581 tooltip = TOOLTIPfeast_for_crows.581 }
				}
			}
		}
		FROM = {
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_prestige = 200
			if = {
				limit = { has_slavery_religion_trigger = yes }
				piety = 100
				religion_authority = {
					modifier = won_holy_war
					years = 20
				}
			}
			any_demesne_title = {
				limit = { has_law = treaty_breach_0 }
				revoke_law = treaty_breach_0
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		hidden_tooltip = {
			FROM = {
				any_realm_province = {
					limit = {
						OR = {
							has_province_modifier = slave_modifier_1
							has_province_modifier = slave_modifier_2
							has_province_modifier = slave_modifier_3
							has_province_modifier = slave_modifier_4
							has_province_modifier = slave_modifier_5
						}
					}
					add_province_modifier = {
						name = thwarted_war_of_liberation_1
						duration = 3650
					}
				}
			}
		}
	}

	on_invalidation = {
		###Special Dany Quest Events
		hidden_tooltip = {
			ROOT = {
				if = {
					limit = { character = 77041 }
					if = {
						limit = { has_character_flag = liberation_of_meereen }
						character_event = { id = clash_of_kings.58 days = 1 }
					}
					if = {
						limit = { has_character_flag = dany_liberation_quest }
						narrative_event = { id = feast_for_crows.57 days = 1 }
						narrative_event = { id = feast_for_crows.58 days = 1 }
					}
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = 100
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1.5
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { can_use_dragon_abilities_trigger = yes } }
			FROM = {
				can_use_dragon_abilities_trigger = yes
				is_incapable = no
			}
		}
		modifier = {
			factor = 0
			ROOT = {
				NOT = { can_use_dragon_abilities_trigger = yes }
				NOT = {
					relative_power = {
						who = FROM
						power = 6
					}
				}
			}
			FROM = {
				can_use_dragon_abilities_trigger = yes
				OR = {
					any_friend = { trait = dragon martial = 60 }
					AND = {  graphical_culture = dragongfx martial = 60 }
				}
				is_incapable = no
			}
		}
		#Pro-Slavery will usually not do this
		modifier = {
			factor = 0
			ROOT = {
				NOT = { trait = liberator }
				NOT = { has_dynasty_flag = liberator_dynasty }
				OR = {
					trait = slave_owner
					trait = slave_trader
					has_slavery_culture_trigger = yes
					has_slavery_religion_trigger = yes
				}
				NOR = {
					has_antislavery_religion_trigger = yes
					has_antislavery_culture_trigger = yes
				}
			}
		}
		modifier = { #Westerosi Rulers dont usually bother with foreign slaver wars
			factor = 0
			ROOT = {
				capital_scope = { region = world_westeros }
				OR = {
					NOT = { culture_group = FROM }
					culture_group = valyrian
				}
				NOT = { trait = liberator }
			}
			FROM = { NOT = { capital_scope = { region = world_westeros } } }
		}
	}
}
war_of_emancipation = {
	name = CB_NAME_EMANCIPATION
	war_name = WAR_NAME_EMANCIPATION
	sprite = 28
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	defender_unoccupied_warscore = yes

	infamy_modifier = 0

	sort_priority = 5000

	can_use_gui = {
		ROOT = {
			OR = { #Must either...
				trait = liberator
				culture_group = FROM #be same culture
				custom_tooltip = {
					text = TOOLTIPwar_of_liberationWESTEROS
					hidden_tooltip = { #both be on Westeros
						capital_scope = { region = world_westeros }
						FROM = { capital_scope = { region = world_westeros } }
					}
				}
				custom_tooltip = { #Neighbour target
					text = TOOLTIPwar_of_liberationNEIGHBOUR
					hidden_tooltip = {
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									owner = { same_realm = FROM }
									AND = {
										is_land = no
										any_neighbor_province = {
											owner = { same_realm = FROM }
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}

	can_use_title = {
		ROOT = {
			NOT = { has_game_rule = { name = slavery value = off } }
		}
		universal_cb_restrictions_trigger = yes
		ROOT = {
			primary_title = { has_law = slavery_0 }
			OR = { #Cannot use during this part of dany quest
				NOT = { has_global_flag = enslavement_of_astapor }
				NOT = { character = 77041 }
			}
		}
		FROM = { has_landed_title = PREV }
		is_primary_holder_title = yes
		higher_tier_than = DUKE
		has_law = slavery_2
		OR = {
			tier = EMPEROR
			NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
		}
	}

	is_valid_title = {
		universal_cb_valid_restrictions_trigger = yes
		ROOT = {
			OR = {
				any_demesne_title = { has_law = slavery_0 }
				trait = liberator
			}
		}
		NOT = { has_law = slavery_1 } #The war continues even if target changes law in middle of war
		FROM = {
			has_landed_title = PREV
		}
	}

	on_add = {
		hidden_tooltip = {
			FROM = {
				if = {
					limit = {
						OR = {
							is_theocracy = yes
							is_republic = yes
						}
					}
					add_character_modifier = { name = defending_anti_slavery_war duration = 30 hidden = yes }
					character_event = { id = diplomatic.3099 } #call for aid?
				}
			}
		}
		FROM = { #Surrender option
			set_character_flag = considering_surrender
			character_event = { id = slavery.790 days = 3 tooltip = TOOLTIPslavery.790 }
		}
		hidden_tooltip = {
			ROOT = {
				if = { #disallow raising of levies whilst surrender is considered
					limit = { tier = EMPEROR }
					add_character_modifier = {
						name = mega_war_no_levies
						duration = 14
						hidden = yes
					}
				}
			}
		}
	}

	on_add_title = {
		e_rebels = {
			persistent_event_target:chronicle_player = {
				if = {
					limit = { character = ROOT }
					chronicle = {
						entry = CHRONICLE_WAR_EMANCIPATION_ATTACKER
						portrait = [From.GetID]
					}
					break = yes
				}
				if = {
					limit = { character = FROM }
					chronicle = {
						entry = CHRONICLE_WAR_EMANCIPATION_DEFENDER
						portrait = [Root.GetID]
					}
					break = yes
				}
				if = {
					limit = { is_liege_or_above = ROOT }
					chronicle = {
						entry = CHRONICLE_WAR_EMANCIPATION_ATTACKER_LIEGE
						portrait = [Root.GetID]
					}
					break = yes
				}
				if = {
					limit = { is_liege_or_above = FROM }
					chronicle = {
						entry = CHRONICLE_WAR_EMANCIPATION_DEFENDER_LIEGE
						portrait = [From.GetID]
					}
				}
			}
		}
	}

	on_success_title = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		hidden_tooltip = {
			mega_war_rebel_leader_resolution_effect = yes
			FROM = {
				remove_trait = rebel_leader
				change_variable = { which = fear_actions value = -20 }
			}
		}
		if = {
			limit = { NOT = { has_game_rule = { name = slavery value = off } } }
			if = {
				limit = { NOT = { has_law = slavery_0 } }
				add_law = slavery_1
			}
			hidden_tooltip = {
				FROM = {
					add_character_modifier = {
						name = realm_emancipated
						duration = 3650
					}
					any_demesne_title = {
						limit = {
							higher_tier_than = DUKE
							NOT = { has_law = slavery_0 }
							NOT = { has_law = slavery_1 }
						}
						add_law = slavery_1
					}
					any_vassal = {
						any_demesne_title = {
							limit = {
								higher_tier_than = DUKE
								NOT = { has_law = slavery_0 }
								NOT = { has_law = slavery_1 }
							}
							add_law = slavery_1
						}
					}
				}
			}
		}
		hidden_tooltip = {
			ROOT = { character_event = { id = maintenance.24 } } #Mega war flag maintenance
		}
	}

	on_success = {
		#Also emancipate any defenders
		if = {
			limit = { NOT = { has_game_rule = { name = slavery value = off } } }
			any_defender = {
				limit = { NOT = { character = FROM } }
				any_demesne_title = {
					limit = {
						higher_tier_than = DUKE
						NOT = { has_law = slavery_0 }
					}
					add_law = slavery_1
					holder_scope = {
						hidden_tooltip = {
							add_character_modifier = {
								name = realm_emancipated
								duration = 3650
							}
						}
					}
				}
			}
		}
		ROOT = {
			prestige = 250
			if = {
				limit = { has_antislavery_religion_trigger = yes }
				religion_authority = {
					modifier = emancipated_realm
				}
			}
		}
		hidden_tooltip = {
			any_attacker = {
				limit = { NOT = { character = ROOT } }
				participation_scaled_prestige = 250
			}
		}
		FROM = {
			prestige = -250
			if = {
				limit = { has_slavery_religion_trigger = yes }
				piety = -100
				religion_authority = {
					modifier = emancipated_realm_lost
				}
			}
		}
		###Special Dany Quest Events
		hidden_tooltip = {
			ROOT = {
				if = {
					limit = { character = 77041 }
					if = {
						limit = { has_character_flag = emancipation_of_yunkai }
						narrative_event = { id = clash_of_kings.57 days = 5 }
					}
					if = {
						limit = { has_character_flag = dany_liberation_quest }
						narrative_event = { id = feast_for_crows.57 days = 1 }
						narrative_event = { id = feast_for_crows.58 days = 1 }
					}
				}
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		###Special Dany Quest Events
		hidden_tooltip = {
			ROOT = {
				if = {
					limit = { character = 77041 }
					if = {
						limit = { has_character_flag = emancipation_of_yunkai }
						narrative_event = { id = clash_of_kings.57 days = 20 }
					}
					if = {
						limit = { has_character_flag = dany_liberation_quest }
						narrative_event = { id = feast_for_crows.57 days = 1 }
						narrative_event = { id = feast_for_crows.58 days = 1 }
					}
				}
			}
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			if = {
				limit = { has_slavery_religion_trigger = yes }
				piety = -100
				religion_authority = {
					modifier = lost_holy_war
					years = 10
				}
			}
			###Special Dany Quest Events
			if = {
				limit = { character = 77041 }
				if = {
					limit = { has_character_flag = emancipation_of_yunkai }
					imprison = FROM
					clr_character_flag = captured_in_battle
					hidden_tooltip = { character_event = { id = clash_of_kings.58 days = 1 } }
				}
				if = {
					limit = { has_character_flag = dany_liberation_quest }
					character_event = { id = feast_for_crows.581 tooltip = TOOLTIPfeast_for_crows.581 }
				}
			}
		}
		FROM = {
			participation_scaled_prestige = 200
			if = {
				limit = { has_antislavery_religion_trigger = yes }
				piety = 100
				religion_authority = {
					modifier = won_holy_war
					years = 10
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		hidden_tooltip = {
			FROM = {
				any_realm_province = {
					limit = {
						OR = {
							has_province_modifier = slave_modifier_1
							has_province_modifier = slave_modifier_2
							has_province_modifier = slave_modifier_3
							has_province_modifier = slave_modifier_4
							has_province_modifier = slave_modifier_5
						}
					}
					add_province_modifier = {
						name = thwarted_war_of_emancipation_1
						duration = 3650
					}
				}
			}
		}
	}

	on_invalidation = {
		###Special Dany Quest Events
		hidden_tooltip = {
			ROOT = {
				if = {
					limit = { character = 77041 }
					if = {
						limit = { has_character_flag = emancipation_of_yunkai }
						narrative_event = { id = clash_of_kings.57 days = 20 }
					}
					if = {
						limit = { has_character_flag = dany_liberation_quest }
						narrative_event = { id = feast_for_crows.57 days = 1 }
						narrative_event = { id = feast_for_crows.58 days = 1 }
					}
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}

	attacker_ai_defeat_worth = {
		factor = 150
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { can_use_dragon_abilities_trigger = yes } }
			FROM = {
				can_use_dragon_abilities_trigger = yes
				is_incapable = no
			}
		}
		modifier = {
			factor = 0
			ROOT = {
				NOT = { can_use_dragon_abilities_trigger = yes }
				NOT = {
					relative_power = {
						who = FROM
						power = 6
					}
				}
			}
			FROM = {
				can_use_dragon_abilities_trigger = yes
				OR = {
					any_friend = { trait = dragon martial = 60 }
					AND = {  graphical_culture = dragongfx martial = 60 }
				}
				is_incapable = no
			}
		}
		#Pro-Slavery will usually not do this
		modifier = {
			factor = 0
			ROOT = {
				NOT = { trait = liberator }
				NOT = { has_dynasty_flag = liberator_dynasty }
				OR = {
					trait = slave_owner
					trait = slave_trader
					has_slavery_culture_trigger = yes
					has_slavery_religion_trigger = yes
				}
				NOR = {
					has_antislavery_religion_trigger = yes
					has_antislavery_culture_trigger = yes
				}
			}
		}
		modifier = { #Westerosi Rulers dont usually bother with foreign slaver wars
			factor = 0
			ROOT = {
				capital_scope = { region = world_westeros }
				OR = {
					NOT = { culture_group = FROM }
					culture_group = valyrian
				}
				NOT = { trait = liberator }
			}
			FROM = { NOT = { capital_scope = { region = world_westeros } } }
		}
		modifier = {
			factor = 0
			ROOT = {
				NOT = { is_nomadic = yes }
				NOT = {
					relative_power = {
						who = FROM
						power = 4
					}
				}
			}
			FROM = { is_nomadic = yes }
		}
	}
}
war_of_enslavement = {
	name = CB_NAME_ENSLAVEMENT
	war_name = WAR_NAME_ENSLAVEMENT
	sprite = 28
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	defender_unoccupied_warscore = yes

	infamy_modifier = 0

	sort_priority = 7000

	can_use_gui = {
		ROOT = {
			is_incapable = no
			OR = { #Must either...
				culture_group = FROM #be same culture
				custom_tooltip = {
					text = TOOLTIPwar_of_liberationWESTEROS
					hidden_tooltip = { #both be on Westeros
						capital_scope = { region = world_westeros }
						FROM = { capital_scope = { region = world_westeros } }
					}
				}
				custom_tooltip = { #Neighbour target
					text = TOOLTIPwar_of_liberationNEIGHBOUR
					hidden_tooltip = {
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									owner = { same_realm = FROM }
									AND = {
										is_land = no
										any_neighbor_province = {
											owner = { same_realm = FROM }
										}
									}
								}
							}
						}
					}
				}
				AND = {
					has_religion_feature = religion_feature_pro_slavery
					piety = 100
					trait = zealous
				}
				hidden_tooltip = { #dany quest enslavement of meereen
					AND = {
						FROM = {
							character = 77041
							has_character_flag = enslavement_of_meereen
						}
						ROOT = { has_landed_title = k_yunkai }
					}
				}
			}
		}
		FROM = { NOT = { is_nomadic = yes } }
	}

	can_use_title = {
		ROOT = {
			NOT = { has_game_rule = { name = slavery value = off } }
		}
		universal_cb_restrictions_trigger = yes
		ROOT = {
			primary_title = { has_law = slavery_2 }
		}
		FROM = {
			has_landed_title = PREV
		}
		is_primary_holder_title = yes
		OR = {
			AND = {
				higher_tier_than = DUKE
				has_law = treaty_breach_1
				has_law = slavery_0
			}
			AND = {
				NOT = { tier = BARON }
				lower_tier_than = DUKE
				has_title_flag = flag_slavery_treaty_breach
			}
			ROOT = {
				has_religion_feature = religion_feature_pro_slavery
				piety = 100
				trait = zealous
			}
		}

		OR = {
			tier = EMPEROR
			NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
		}
		OR = { #Cannot be used against Astapor in the Dany quest until the right time
			ROOT = { NOT = { has_global_flag = no_enslave_astapor } }
			NOT = { title = k_astapor }
		}
	}

	is_valid_title = {
		universal_cb_valid_restrictions_trigger = yes
		OR = {
			ROOT = { any_demesne_title = { has_law = slavery_2 } }
			#Special dany quest enslavements
			FROM = { has_character_flag = enslavement_of_meereen }
			has_global_flag = enslavement_of_astapor
		}
		FROM = {
			has_landed_title = PREV
		}
	}

	on_add_title = {
		if = {
			limit = {
				NOR = {
					AND = {
						higher_tier_than = DUKE
						has_law = treaty_breach_1
						has_law = slavery_0
					}
					AND = {
						NOT = { tier = BARON }
						lower_tier_than = DUKE
						has_title_flag = flag_slavery_treaty_breach
					}
				}
			}
			ROOT = { piety = -100 }
		}
		e_rebels = {
			persistent_event_target:chronicle_player = {
				if = {
					limit = { character = ROOT }
					chronicle = {
						entry = CHRONICLE_WAR_ENSLAVEMENT_ATTACKER
						portrait = [From.GetID]
					}
					break = yes
				}
				if = {
					limit = { character = FROM }
					chronicle = {
						entry = CHRONICLE_WAR_ENSLAVEMENT_DEFENDER
						portrait = [Root.GetID]
					}
					break = yes
				}
				if = {
					limit = { is_liege_or_above = ROOT }
					chronicle = {
						entry = CHRONICLE_WAR_ENSLAVEMENT_ATTACKER_LIEGE
						portrait = [Root.GetID]
					}
					break = yes
				}
				if = {
					limit = { is_liege_or_above = FROM }
					chronicle = {
						entry = CHRONICLE_WAR_ENSLAVEMENT_DEFENDER_LIEGE
						portrait = [From.GetID]
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = {
			FROM = {
				add_character_modifier = { name = defending_anti_piracy_war days = 30 hidden = yes }
				character_event = { id = diplomatic.3099 } #call for aid?
			}
		}
		ROOT = { #Some characters unhappy
			if = {
				limit = {
					OR = {
						has_antislavery_religion_trigger = yes
						has_antislavery_culture_trigger = yes
					}
				}
				character_event = { id = slavery.760 days = 1 tooltip = TOOLTIPslavery.760 }
			}
		}
	}

	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		hidden_tooltip = {
			mega_war_rebel_leader_resolution_effect = yes
			FROM = {
				remove_trait = rebel_leader
			}
		}
		ROOT = {
			prestige = 200
			if = {
				limit = { has_slavery_religion_trigger = yes }
				religion_authority = {
					modifier = enslaved_realm
				}
			}
		}
		ROOT = {
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		FROM = {
			if = {
				limit = { NOT = { has_game_rule = { name = slavery value = off } } }
				capital_scope = {
					# The attacker gains a slave camp level
					if = {
						limit = { ROOT = { crownlaw_title = { has_law = slavery_2 } } }
						ROOT = { character_event = { id = slavery.1000 tooltip = "EVTTOOLTIPSLAVERY1000" } }
					}
					slave_raid_gain_slaves_effect = yes
				}

				# Auto-enslave all prisoners of war
				any_realm_character = {
					limit = {
						prisoner = yes
						host = { character = ROOT }
						is_liege_or_above = FROM
						NOT = { trait = slave }
					}
					add_trait = slave
					hidden_tooltip = {
						prisoner = no
						clr_character_flag = captured_in_battle
						clr_character_flag = lost_trial_by_combat
						clr_character_flag = imprisoned_for_relatives_crimes
						ROOT = { reverse_banish = PREV }
						#give_minor_title = title_slave
						opinion = { who = ROOT modifier = opinion_my_owner }
						reverse_opinion = { who = ROOT modifier = opinion_my_slave }
						opinion = { who = ROOT modifier = opinion_enslaved_me }
					}
				}
			}
		}
		hidden_tooltip = {
			ROOT = {
				occupy_minors_of_occupied_settlements = FROM
				gain_all_occupied_titles = FROM
			}
		}

		FROM = {
			prestige = -400
			if = {
				limit = { has_antislavery_religion_trigger = yes }
				piety = -200
				religion_authority = {
					modifier = enslaved_realm_lost
				}
			}
		}
		###Special Dany Quest Events
		hidden_tooltip = {
			if = {
				limit = {
					ROOT = {
						has_landed_title = k_yunkai
						has_global_flag = enslavement_of_astapor
					}
				}
				k_meereen = {
					holder_scope = {
						set_character_flag = enslavement_of_meereen
						narrative_event = { id = feast_for_crows.53 days = 30 }
					}
					reverse_unsafe_war = {
						target = ROOT
						casus_belli = war_of_enslavement
					}
				}
				clr_global_flag = enslavement_of_astapor
				any_attacker = {
					limit = { NOT = { character = ROOT } }
					character_event = { id = feast_for_crows.52 days = 1 }
				}
				ROOT = {
					any_war = {
						limit = {
							OR = {
								using_cb = slave_raid
								defender = { character = ROOT }
							}
						}
						end_war = invalid
					}
				}
				FROM = { abdicate_to = ROOT } #Cleon shouldn't be left with any titles
			}
			if = {
				limit = {
					FROM = {
						character = 77041
						has_landed_title = k_meereen
						has_character_flag = enslavement_of_meereen
					}
				}
				FROM = {
					imprison = ROOT
					clr_character_flag = captured_in_battle
					hidden_tooltip = { character_event = { id = clash_of_kings.58 days = 1 } }
				}
			}
		}
	}

	on_success_title = {
		custom_tooltip = {
			text = invasion_succ_tip
			hidden_tooltip = {
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
				FROM = {
					set_defacto_liege = ROOT
				}
				if = {
					limit = {
						FROM = { is_liege_or_above = ROOT }
					}
					FROM = { imprison = ROOT clr_character_flag = captured_in_battle }
				}
			}
		}
		if = {
			limit = { NOT = { has_game_rule = { name = slavery value = off } } }
			add_law = slavery_2
			clr_title_flag = flag_slavery_treaty_breach
		}
		hidden_tooltip = {
			ROOT = { character_event = { id = maintenance.24 } } #Mega war flag maintenance
			FROM = {
				if = {
					limit = { is_liege_or_above = ROOT }
					character_event = { id = maintenance.25 } #Subjugation flag maintenance
				}
			}
			if = {
				limit = { title = e_iron_throne } #Lose crownlands
				holder_scope = { character_event = { id = maintenance.37 } }
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		###Special Dany Quest Events
		hidden_tooltip = {
			if = {
				limit = {
					ROOT = {
						has_landed_title = k_yunkai
						has_global_flag = enslavement_of_astapor
					}
				}
				clr_global_flag = enslavement_of_astapor
				k_meereen = {
					holder_scope = {
						set_character_flag = enslavement_of_meereen
						narrative_event = { id = feast_for_crows.53 days = 30 }
					}
					reverse_unsafe_war = {
						target = ROOT
						casus_belli = war_of_enslavement
					}
				}
				any_attacker = {
					limit = { NOT = { character = ROOT } }
					character_event = { id = feast_for_crows.52 days = 1 }
				}
			}
			if = {
				limit = {
					FROM = {
						character = 77041
						has_landed_title = k_meereen
						has_character_flag = enslavement_of_meereen
					}
				}
				FROM = {
					set_character_flag = dany_liberation_quest
					narrative_event = { id = feast_for_crows.57 days = 2 }
				}
			}
		}
	}

	on_reverse_demand_title = {
		if = {
			limit = { has_law = treaty_breach_1 }
			revoke_law = treaty_breach_1
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			if = {
				limit = { has_antislavery_religion_trigger = yes }
				piety = -100
				religion_authority = {
					modifier = lost_holy_war
					years = 20
				}
			}
		}
		FROM = {
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_prestige = 200
			if = {
				limit = { has_slavery_religion_trigger = yes }
				piety = 100
				religion_authority = {
					modifier = won_holy_war
					years = 20
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		###Special Dany Quest Events
		hidden_tooltip = {
			if = {
				limit = {
					ROOT = {
						has_landed_title = k_yunkai
						has_global_flag = enslavement_of_astapor
					}
				}
				clr_global_flag = enslavement_of_astapor
				k_meereen = {
					holder_scope = {
						set_character_flag = enslavement_of_meereen
						narrative_event = { id = feast_for_crows.53 days = 30 }
					}
					reverse_unsafe_war = {
						target = ROOT
						casus_belli = war_of_enslavement
					}
				}
				any_attacker = {
					limit = { NOT = { character = ROOT } }
					character_event = { id = feast_for_crows.52 days = 1 }
				}
			}
			if = {
				limit = {
					FROM = {
						character = 77041
						has_landed_title = k_meereen
						has_character_flag = enslavement_of_meereen
					}
				}
				FROM = {
					set_character_flag = dany_liberation_quest
					set_character_flag = liberate_yunkai
					narrative_event = { id = feast_for_crows.57 days = 2 }
				}
			}
		}
	}

	on_invalidation = {
		###Special Dany Quest Events
		hidden_tooltip = {
			if = {
				limit = {
					ROOT = {
						has_landed_title = k_yunkai
						has_global_flag = enslavement_of_astapor
					}
				}
				clr_global_flag = enslavement_of_astapor
				k_meereen = {
					holder_scope = {
						set_character_flag = enslavement_of_meereen
						narrative_event = { id = feast_for_crows.53 days = 30 }
					}
					reverse_unsafe_war = {
						target = ROOT
						casus_belli = war_of_enslavement
					}
				}
				any_attacker = {
					limit = { NOT = { character = ROOT } }
					character_event = { id = feast_for_crows.52 days = 1 }
				}
			}
			if = {
				limit = {
					FROM = {
						character = 77041
						has_landed_title = k_meereen
						has_character_flag = enslavement_of_meereen
					}
				}
				FROM = {
					set_character_flag = dany_liberation_quest
					#set_character_flag = liberate_yunkai
					narrative_event = { id = feast_for_crows.57 days = 2 }
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = 150
	}

	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}

	defender_ai_defeat_worth = {
		factor = 100
	}

	ai_will_do = {
		factor = 1.5
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { can_use_dragon_abilities_trigger = yes } }
			FROM = {
				can_use_dragon_abilities_trigger = yes
				is_incapable = no
			}
		}
		modifier = {
			factor = 0
			ROOT = {
				NOT = { can_use_dragon_abilities_trigger = yes }
				NOT = {
					relative_power = {
						who = FROM
						power = 6
					}
				}
			}
			FROM = {
				can_use_dragon_abilities_trigger = yes
				OR = {
					any_friend = { trait = dragon martial = 60 }
					AND = {  graphical_culture = dragongfx martial = 60 }
				}
				is_incapable = no
			}
		}

		modifier = {
			factor = 0
			ROOT = {
				OR = {
					trait = liberator
					has_dynasty_flag = liberator_dynasty
					has_antislavery_religion_trigger = yes
					has_antislavery_culture_trigger = yes
				}
			}
		}
		#Anti-Slavery will usually not do this
		modifier = {
			factor = 0
			ROOT = {
				OR = {
					has_antislavery_religion_trigger = yes
					has_antislavery_culture_trigger = yes
				}
				OR = {
					trait = zealous
					trait = honorable
					trait = kind
					AND = {
						NOT = { trait = arbitrary }
						NOT = { trait = ruthless }
						NOT = { trait = lunatic }
					}
				}
			}
		}
		modifier = {
			factor = 0
			ROOT = { trait = liberator }
		}
	}
}