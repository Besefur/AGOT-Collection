###DIPLOMACY EVENTS FOR CHINA OFF-MAP POWER###

#Written by:
#Milla Isaksson
#Joel Hansson
#Mathilda Bjarnehed
#Drikus Kuiper
#Daniel Moore
#Alexander Oltner

namespace = JD

###Chinese guests (the Governor's councilor comes to visit)
#AGOT: adapted to guest from the far east
character_event = {
    id = JD.20000
    hide_window = yes

    is_triggered_only = yes
	only_independent = yes
    only_capable = yes
    has_dlc = "Jade Dragon"
    prisoner = no
    war = no
    min_age = 16

    trigger = {
		higher_tier_than = DUKE
		OR = {
			tier = EMPEROR
			primary_title = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } }
		}
		capital_scope = {
			OR = {
				region = world_westeros
				region = world_free_cities
				region = world_summer_islands
			}
		}
        is_inaccessible_trigger = no
		NOT = { has_character_flag = chinese_governor_councilor_guest }
    }

    weight_multiplier = {
    	days = 1
    }

    immediate = {
		random_independent_ruler = {
			limit = {
				capital_scope = { region = world_far_east }
				NOT = { culture_group = ROOT }
				NOT = { dynasty = ROOT }
				OR = {
					tier = EMPEROR
					primary_title = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } }
				}
				war = no
				is_inaccessible_trigger = no
				NOT_mythical_creature_trigger = yes
				is_feudal_monarch_trigger = yes
			}
			primary_title = { save_event_target_as = target_governor_title }
			save_event_target_as = target_governor
			#Selects a diplomat
			random_list = {
				1 = { }
				25 = {
					trigger = {
						job_castellan = {
							culture_group = PREV
							NOT = { character = ROOT }
						}
					}

					job_castellan = {
						#Picks a reason for visiting
						random_list = {
							10 = {
								set_character_flag = cg_diplomatic_visit
							}
							10 = {
								trigger = { ROOT = { is_liege_or_above = event_target:target_governor } }
								set_character_flag = cg_oversee_troops
							}
							10 = {
								trigger = { ROOT = { NOT = { is_liege_or_above = event_target:target_governor } } }
								set_character_flag = cg_study_military
							}
							10 = {
								trigger = { ROOT = { is_liege_or_above = event_target:target_governor } }
								set_character_flag = cg_oversee_tax_collection
							}
							10 = {
								trigger = { ROOT = { NOT = { is_liege_or_above = event_target:target_governor } } }
								set_character_flag = cg_trade
							}
						}
						character_event = { id = JD.20001 }
					}
				}
				100 = {
					trigger = {
						job_chancellor = {
							culture_group = PREV
							NOT = { character = ROOT }
						}
					}

					job_chancellor = {
						#Picks a reason for visiting
						set_character_flag = cg_diplomatic_visit

						character_event = { id = JD.20001 }
					}
				}
				100 = {
					trigger = {
						job_marshal = {
							culture_group = PREV
							NOT = { character = ROOT }
						}
					}

					job_marshal = {
						#Picks a reason for visiting
						random_list = {
							10 = {
								trigger = { ROOT = { is_liege_or_above = event_target:target_governor } }
								set_character_flag = cg_oversee_troops
							}
							10 = {
								trigger = { ROOT = { NOT = { is_liege_or_above = event_target:target_governor } } }
								set_character_flag = cg_study_military
							}
						}
						character_event = { id = JD.20001 }
					}
				}
				100 = {
					trigger = {
						job_treasurer = {
							culture_group = PREV
							NOT = { character = ROOT }
						}
					}

					job_treasurer = {
						#Picks a reason for visiting
						random_list = {
							10 = {
								trigger = { ROOT = { is_liege_or_above = event_target:target_governor } }
								set_character_flag = cg_oversee_tax_collection
							}
							10 = {
								trigger = { ROOT = { NOT = { is_liege_or_above = event_target:target_governor } } }
								set_character_flag = cg_trade
							}
						}
						character_event = { id = JD.20001 }
					}
				}
				100 = {
					trigger = {
						job_spiritual = {
							culture_group = PREV
							NOT = { character = ROOT }
						}
					}

					job_spiritual = {
						#Picks a reason for visiting
						random_list = {
							10 = {
								trigger = { ROOT = { is_liege_or_above = event_target:target_governor } }
								set_character_flag = cg_preaching
							}
							10 = {
								trigger = { ROOT = { NOT = { is_liege_or_above = event_target:target_governor } } }
								set_character_flag = cg_study_theology
							}
						}
						character_event = { id = JD.20001 }
					}
				}
			}
		}
    }
}

#Ping event
character_event = {
    id = JD.20001
	has_dlc = "Jade Dragon"
    hide_window = yes
    is_triggered_only = yes
    immediate = {
    	save_event_target_as = chinese_guest
    	FROM = { letter_event = { id = JD.20002 } }
    }
}

#Chinese guests announces their intention to visit
letter_event = {
    id = JD.20002
	has_dlc = "Jade Dragon"
    border = GFX_event_letter_frame_diplomacy

    desc = {
    	text = EVTDESC_JD_20002_A
    	trigger = { is_liege_or_above = event_target:target_governor }
    }
    desc = {
    	text = EVTDESC_JD_20002_B
    	trigger = { NOT = { is_liege_or_above = event_target:target_governor } }
    }

    is_triggered_only = yes

    #Welcome!
    option = {
        name = EVTOPTA_JD_20002
		sound_effect = china_grace_gain
        custom_tooltip = { text = EVTOPTA_JD_20002_TT }

        prestige = 50

        hidden_effect = {
        	event_target:chinese_guest = { character_event = { id = JD.20003 days = 50 random = 20 } }
            set_character_flag = chinese_governor_councilor_guest
        }
    }

    #Go away
    option = {
        name = EVTOPTB_JD_20002
        custom_tooltip = { text = EVTOPTB_JD_20002_TT }
    	prestige = -25

    	event_target:chinese_guest = {
            show_scope_change = no
    		opinion = {
                who = ROOT
    			modifier = opinion_offended
    			years = 15
    		}
    	}
    	event_target:chinese_guest = {
            show_scope_change = no
            liege = {
                show_scope_change = no
        		opinion = {
                    who = ROOT
        			modifier = opinion_offended
        			years = 15
        		}
            }
    	}
    }
}

#Tombola for outcomes
character_event = {
    id = JD.20003
	has_dlc = "Jade Dragon"
    hide_window = yes
    is_triggered_only = yes
    trigger = {
        is_alive = yes
        event_target:target_governor_title = { holder_scope = { is_liege_of = ROOT } }
    }
    immediate = {
        FROM = {
            #Save corresponding councilor
			if = {
                limit = { ROOT = { has_job_title = job_castellan } }
               job_castellan = { save_event_target_as = corresponding_councilor }
            }
            if = {
                limit = { ROOT = { has_job_title = job_chancellor } }
                job_chancellor = { save_event_target_as = corresponding_councilor }
            }
            if = {
                limit = { ROOT = { has_job_title = job_marshal } }
                job_marshal = { save_event_target_as = corresponding_councilor }
            }
            if = {
                limit = { ROOT = { has_job_title = job_treasurer } }
                job_treasurer = { save_event_target_as = corresponding_councilor }
            }
            if = {
                limit = { ROOT = { has_job_title = job_spiritual } }
                job_spiritual = { save_event_target_as = corresponding_councilor }
            }

            #Tombola
    		random_list = { #All is well
    			30 = {
                    modifier = {
                        OR = {
							event_target:corresponding_councilor = {
                                has_job_title = job_castellan
                                stewardship < 8
                            }
                            event_target:corresponding_councilor = {
                                has_job_title = job_chancellor
                                diplomacy < 8
                            }
                            event_target:corresponding_councilor = {
                                has_job_title = job_marshal
                                martial < 8
                            }
                            event_target:corresponding_councilor = {
                                has_job_title = job_treasurer
                                stewardship < 8
                            }
                            event_target:corresponding_councilor = {
                                has_job_title = job_spiritual
                                learning < 8
                            }
                        }
                        factor = 0.5
                    }
                    trigger = { event_target:corresponding_councilor = { always = yes } }
                    character_event = { id = JD.20004 }
                }
                10 = { #Falling stars
                    character_event = { id = JD.20005 }
                }
                10 = { #Greet in chinese?
					trigger = { event_target:chinese_guest = { NOT = { culture_group = ROOT_FROM } } }
                    modifier = { is_learned_trigger = yes factor = 1.3 }
                    character_event = { id = JD.20006 }
                }
                10 = { #Wearing the clothes wrong
					trigger = { event_target:chinese_guest = { NOT = { culture_group = ROOT_FROM } } }
                    modifier = { is_dumb_incl_imbecile_trigger = yes factor = 1.3 }
                    modifier = { trait = greedy factor = 1.3 }
                    character_event = { id = JD.20011 }
                }
                10 = { #What you said (apparently) had a deep hidden meaning
                    modifier = { is_smart_incl_genius_trigger = yes factor = 1.3 }
                    modifier = { trait = gregarious factor = 1.3 }
                    modifier = { trait = poet factor = 1.5 }
                    modifier = { trait = socializer factor = 1.3 }
                    character_event = { id = JD.20012 }
                }
    		}

            #Clear-up event
            character_event = { id = JD.20020 days = 90 }
    	}
    }
}

#The visit went well
character_event = {
    id = JD.20004
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_20004
    picture = GFX_evt_china_diplomatic_success
    border = GFX_event_normal_frame_diplomacy

    is_triggered_only = yes

    option = {
        name = EVTOPTA_JD_20004
        prestige = 25
		sound_effect = china_grace_gain

        event_target:corresponding_councilor = {
            show_portrait = yes
        }

        hidden_effect = {
            random = {
                chance = 75
                modifier = {
                    factor = 0.05
                    any_artifact = { has_artifact_flag = chinese }
                }
                character_event = { id = JD.60004 days = 1 }
            }
        }
    }
}

#Falling stars
character_event = {
    id = JD.20005
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_20005
    picture = GFX_evt_comet
    border = GFX_event_normal_frame_religion

    is_triggered_only = yes

    option = {
        name = EVTOPTA_JD_20005
        custom_tooltip = { text = EVTOPTA_JD_20005_tt }
        prestige = -25
    }
}

#Greeting guest in Chinese
character_event = {
    id = JD.20006
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_20006
    picture = GFX_evt_daughter_asking_father
    border = GFX_event_normal_frame_diplomacy

    is_triggered_only = yes

    #Study hard
    option = {
        trigger = {
			NOR = {
				has_character_modifier = multilingual
				trait = linguist
			}
		}
        name = EVTOPTA_JD_20006

        random_list = {
            35 = { #Succeed
                modifier = { learning = 12 factor = 1.15 }
                modifier = { learning = 14 factor = 1.15 }
                modifier = { learning = 16 factor = 1.15 }
                modifier = { learning = 18 factor = 1.2 }
                modifier = { learning = 20 factor = 1.2 }
                modifier = { is_smart_incl_genius_trigger = yes factor = 1.5 }
                modifier = { is_learned_trigger = yes factor = 1.5 }
                modifier = { has_character_modifier = student_of_language factor = 1.5 }


                custom_tooltip = { text = EVTOPTA_JD_20006_SUCCESS_TT }

                #Showing tooltip for language modifiers
				if = {
                    limit = {
                        has_character_modifier = student_of_language
                    }
                    custom_tooltip = { text = multilingual_tt }
                    tooltip = { prestige = 100 }
                }
                else = {
                    custom_tooltip = { text = student_of_language_tt }
                    tooltip = { prestige = 100 }
                }


                hidden_effect = { character_event = { id = JD.20007 days = 3 } }
            }
            65 = { #Fail and fall asleep
                modifier = { is_dumb_incl_imbecile_trigger = yes factor = 2 }
                modifier = { learning < 6 factor = 1.5 }
                custom_tooltip = { text = EVTOPTA_JD_20006_FAILURE_TT }
                tooltip = { prestige = -100 }
                hidden_effect = { character_event = { id = JD.20008 days = 3 } }
            }
        }
    }

    #Wing it
    option = {
        trigger = {
			NOR = {
				has_character_modifier = multilingual
				trait = linguist
			}
		}
        name = EVTOPTB_JD_20006

        random_list = {
            65 = { #You do okay
                modifier = { learning = 12 factor = 1.15 }
                modifier = { learning = 14 factor = 1.15 }
                modifier = { learning = 16 factor = 1.15 }
                modifier = { learning = 18 factor = 1.2 }
                modifier = { learning = 20 factor = 1.2 }
                modifier = { is_smart_trigger = yes factor = 1.5 }
                modifier = { is_learned_trigger = yes factor = 1.5 }
                modifier = { has_character_modifier = student_of_language factor = 1.5 }

                custom_tooltip = { text = EVTOPTB_JD_20006_SUCCESS_TT }
                tooltip = { prestige = 50 }
                hidden_effect = { character_event = { id = JD.20009 days = 3 } }
            }
            35 = { #You mess up the words
                modifier = { is_dumb_incl_imbecile_trigger = yes factor = 2 }
                modifier = { learning < 6 factor = 1.5 }
                custom_tooltip = { text = EVTOPTB_JD_20006_FAILURE_TT }
                tooltip = { prestige = -50 }
                hidden_effect = { character_event = { id = JD.20010 days = 3 } }
            }
        }
    }

    #You're multilingual already!
    option = {
        trigger = {
			OR = {
				has_character_modifier = multilingual
				trait = linguist
			}
		}
		sound_effect = china_grace_gain
        tooltip_info = yes
        custom_tooltip = { text = multilingual_option_available_tt }

        name = EVTOPTC_JD_20006
        custom_tooltip = { text = EVTOPTC_JD_20006_TT }
		prestige = 50
    }

    #Let your translator do the hard work.
    option = {
        name = EVTOPTD_JD_20006
		sound_effect = china_grace_gain
        custom_tooltip = { text = EVTOPTD_JD_20006_TT }

        prestige = 25
    }
}

#You learn about languages!
character_event = {
    id = JD.20007
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_20007
    picture = GFX_evt_chinese_bureaucrat
    border = GFX_event_normal_frame_religion

    is_triggered_only = yes

    option = {
        name = EVTOPTA_JD_20007
		sound_effect = china_grace_gain
        custom_tooltip = { text = EVTOPTA_JD_20007_TT }

        if = {
            limit = {
                has_character_modifier = student_of_language
            }
            add_character_modifier = {
                name = multilingual
                duration = -1
            }
            hidden_effect = {
                remove_character_modifier = student_of_language
            }
        }
        if = {
            limit = {
                NOR = {
                    has_character_modifier = student_of_language
                    has_character_modifier = multilingual
                }
            }

            add_character_modifier = {
                name = student_of_language
                duration = -1
            }
        }

        prestige = 100

        hidden_effect = {
            random = {
                chance = 95
                modifier = {
                    factor = 0.05
                    any_artifact = { has_artifact_flag = chinese }
                }
                character_event = { id = JD.60004 days = 1 }
            }
        }
    }
}

#You fell asleep!
character_event = {
    id = JD.20008
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_20008
    picture = GFX_evt_bad_news
    border = GFX_event_normal_frame_religion

    is_triggered_only = yes

    hide_from = yes

    option = {
        name = EVTOPTA_JD_20008
        custom_tooltip = { text = EVTOPTA_JD_20008_TT }

		prestige = -100
    }
}

#You great them nicely
character_event = {
    id = JD.20009
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_20009
    picture = GFX_evt_chinese_bureaucrat
    border = GFX_event_normal_frame_religion

    is_triggered_only = yes

    option = {
        name = EVTOPTA_JD_20009
        custom_tooltip = { text = EVTOPTA_JD_20009_TT }
		sound_effect = china_grace_gain

        prestige = 50

        hidden_effect = {
            random = {
                chance = 75
                modifier = {
                    factor = 0.05
                    any_artifact = { has_artifact_flag = chinese }
                }
                character_event = { id = JD.60004 days = 1 }
            }
        }
    }
}

#You great them awkwardly
character_event = {
    id = JD.20010
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_20010
    picture = GFX_evt_china_diplomatic_incident
    border = GFX_event_normal_frame_religion

    is_triggered_only = yes

    option = {
        name = EVTOPTA_JD_20010
        custom_tooltip = { text = EVTOPTA_JD_20010_TT }

        prestige = -50
    }
}



#Closet malfunction
character_event = {
    id = JD.20011
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_20011
    picture = GFX_evt_china_diplomatic_incident
    border = GFX_event_normal_frame_diplomacy

    is_triggered_only = yes

    option = {
        name = EVTOPTA_JD_20011
        custom_tooltip = { text = EVTOPTA_JD_20011_tt }
        prestige = -25
    }
}

#Deep meaningful insight
character_event = {
    id = JD.20012
	has_dlc = "Jade Dragon"
    desc = {
        trigger = {
            event_target:target_governor = { NOT = { culture_group = ROOT } }
        }
        text = EVTDESC_JD_20012
    }
    desc = {
        trigger = {
            event_target:target_governor = { culture_group = ROOT }
        }
        text = EVTDESC_JD_20012_B
    }
    picture = GFX_evt_garden
    border = GFX_event_normal_frame_diplomacy

    is_triggered_only = yes

    option = {
        name = EVTOPTA_JD_20012
		sound_effect = china_grace_gain
        custom_tooltip = { text = EVTOPTA_JD_20012_tt }
        prestige = 50

        hidden_effect = {
            random = {
                chance = 90
                modifier = {
                    factor = 0.05
                    any_artifact = { has_artifact_flag = chinese }
                }
                character_event = { id = JD.60004 days = 1 }
            }
        }
    }
}

#Cleanup
character_event = {
    id = JD.20020
	has_dlc = "Jade Dragon"
    hide_window = yes
    is_triggered_only = yes
    immediate = {
        clr_character_flag = chinese_governor_councilor_guest
        event_target:chinese_guest = {
            clr_character_flag = cg_diplomatic_visit
            clr_character_flag = cg_oversee_troops
            clr_character_flag = cg_study_military
            clr_character_flag = cg_oversee_tax_collection
            clr_character_flag = cg_trade
            clr_character_flag = cg_preaching
            clr_character_flag = cg_study_theology
            if = {
                limit = {
                    persistent_event_target:host_of_chinese_diplomat = { always = yes }
                }
                clear_persistent_event_target = host_of_chinese_diplomat
            }
        }
        FROMFROM = { #for the fallback if death/prison
            clr_character_flag = cg_diplomatic_visit
            clr_character_flag = cg_oversee_troops
            clr_character_flag = cg_study_military
            clr_character_flag = cg_oversee_tax_collection
            clr_character_flag = cg_trade
            clr_character_flag = cg_preaching
            clr_character_flag = cg_study_theology
            if = {
                limit = {
                    persistent_event_target:host_of_chinese_diplomat = { always = yes }
                }
                clear_persistent_event_target = host_of_chinese_diplomat
            }
        }
    }
}

### Hidden start for Mini-Expedition to China #### (random event, fired from yearly pulse)
#AGOT: adapted to trip to far east
character_event = {
    id = JD.10009
    hide_window = yes
    is_triggered_only = yes
    only_playable = yes

    only_capable = yes
    has_dlc = "Jade Dragon"
    prisoner = no
    war = no
    min_age = 13

    trigger = {
		capital_scope = {
			OR = {
				region = world_westeros
				region = world_free_cities
				region = world_summer_islands
			}
		}
		demesne_size = 1
		NOT = { mercenary = yes }
        NOT = { has_character_flag = chinese_governor_councilor_guest }
        NOT = { has_character_flag = is_sending_someone_to_china }
        is_inaccessible_trigger = no
		NOT_mythical_creature_trigger = yes
		NOT = { culture = moon_clansman }
		NOT = { wildling_culture_trigger = yes }

        any_courtier = {
			is_ruler = no
			in_command = no
			NOT = { has_minor_title = title_triarch }
			OR = {
				is_female = no
				gender_equality_trigger = yes
			}
			OR = {
				trait = hedonist
				trait = diligent
				trait = ambitious
			}
			NOT = { trait = content }
			NOT = { trait = slothful }
            is_heir = no
            block_general_event_trigger = no
			NOT = { has_minor_title = title_commander }
			has_epidemic = no
			is_ill = no
			NOT = { has_severe_disability_trigger = yes }
			can_press_claims_trigger = yes
			NOT = { has_character_modifier = went_on_foreign_tour }
			NOT = { has_character_flag = originated_from_chinese_court }
        }
    }

    weight_multiplier = {
        factor = 1
    }

    immediate = {
		random_independent_ruler = {
			limit = {
				capital_scope = { region = world_far_east }
				NOT = { culture_group = ROOT }
				NOT = { dynasty = ROOT }
				OR = {
					tier = EMPEROR
					primary_title = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } }
				}
				war = no
				is_inaccessible_trigger = no
				NOT_mythical_creature_trigger = yes
				is_feudal_monarch_trigger = yes
			}
			save_event_target_as = the_protector_general
			primary_title = { save_event_target_as = the_protector_general_title }
			ROOT = {
				random_courtier = {
					limit = {
						is_ruler = no
						in_command = no
						NOT = { has_minor_title = title_triarch }
						NOT = { culture_group = PREVPREV }
						OR = {
							is_female = no
							gender_equality_trigger = yes
						}
						OR = {
							trait = hedonist
							trait = diligent
							trait = ambitious
						}
						NOT = { trait = content }
						NOT = { trait = slothful }
						is_heir = no
						block_general_event_trigger = no
						NOT = { has_minor_title = title_commander }
						has_epidemic = no
						is_ill = no
						NOT = { has_severe_disability_trigger = yes }
						can_press_claims_trigger = yes
						NOT = { has_character_modifier = went_on_foreign_tour }
						NOT = { has_character_flag = originated_from_chinese_court }
						NOT = { has_character_flag = wants_to_travel_0 }
						NOT = { has_character_flag = wants_to_travel_1 }
						NOT = { has_character_flag = wants_to_travel_2 }
					}
					save_event_target_as = adventurous_spirit
					set_character_flag = wants_to_travel_0
					character_event = { id = JD.10010 }
				}
			}
        }
    }
}


character_event = { #ping event
    id = JD.10010
	has_dlc = "Jade Dragon"
    hide_window = yes
    is_triggered_only = yes
    immediate = { FROM = { character_event = { id = JD.10011 } } }
}

#Your courtier wants to travel to China!
character_event = {
    id = JD.10011
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_10011
    picture = GFX_evt_china_open
    border = GFX_event_normal_frame_diplomacy
    is_triggered_only = yes

    immediate = {
        #Saves home court in case of death of ROOT...
        capital_scope = {
            save_event_target_as = original_court_province_target
        }

        #Find a suitable back-up for the journey... (preferably a spouse, then a lover, then a friend, and in worst case, some random person at court)
        random_courtier = {
            limit = {
				is_married = ROOT

                is_ruler = no
				in_command = no
				NOT = { has_minor_title = title_triarch }
				NOT = { culture_group = event_target:the_protector_general }
				OR = {
					is_female = no
					gender_equality_trigger = yes
				}
				is_heir = no
				block_general_event_trigger = no
				NOT = { has_minor_title = title_commander }
				has_epidemic = no
				is_ill = no
				NOT = { has_severe_disability_trigger = yes }
				can_press_claims_trigger = yes

                NOT = { has_character_flag = wants_to_travel_0 }
                NOT = { has_character_flag = wants_to_travel_1 }
                NOT = { has_character_flag = wants_to_travel_2 }
                NOT = { has_character_flag = originated_from_chinese_court }
            }
            save_event_target_as = back_up_target_1
            set_character_flag = wants_to_travel_1
        }
		if = {
			limit = { NOT = { event_target:back_up_target_1 = { always = yes } } }
			random_courtier = {
				limit = {
					is_lover = ROOT

					is_ruler = no
					in_command = no
					NOT = { has_minor_title = title_triarch }
					NOT = { culture_group = event_target:the_protector_general }
					OR = {
						is_female = no
						gender_equality_trigger = yes
					}
					is_heir = no
					block_general_event_trigger = no
					NOT = { has_minor_title = title_commander }
					has_epidemic = no
					is_ill = no
					NOT = { has_severe_disability_trigger = yes }
					can_press_claims_trigger = yes

					NOT = { has_character_flag = wants_to_travel_0 }
					NOT = { has_character_flag = wants_to_travel_1 }
					NOT = { has_character_flag = wants_to_travel_2 }
					NOT = { has_character_flag = originated_from_chinese_court }
				}
				save_event_target_as = back_up_target_1
				set_character_flag = wants_to_travel_1
			}
		}
		if = {
			limit = { NOT = { event_target:back_up_target_1 = { always = yes } } }
			random_courtier = {
				limit = {
					is_friend = ROOT

					is_ruler = no
					in_command = no
					NOT = { has_minor_title = title_triarch }
					NOT = { culture_group = event_target:the_protector_general }
					OR = {
						is_female = no
						gender_equality_trigger = yes
					}
					is_heir = no
					block_general_event_trigger = no
					NOT = { has_minor_title = title_commander }
					has_epidemic = no
					is_ill = no
					NOT = { has_severe_disability_trigger = yes }
					can_press_claims_trigger = yes

					NOT = { has_character_flag = wants_to_travel_0 }
					NOT = { has_character_flag = wants_to_travel_1 }
					NOT = { has_character_flag = wants_to_travel_2 }
					NOT = { has_character_flag = originated_from_chinese_court }
				}
				save_event_target_as = back_up_target_1
				set_character_flag = wants_to_travel_1
			}
		}
		if = {
			limit = { NOT = { event_target:back_up_target_1 = { always = yes } } }
			random_courtier = {
				limit = {
					is_ruler = no
					in_command = no
					NOT = { has_minor_title = title_triarch }
					NOT = { culture_group = event_target:the_protector_general }
					OR = {
						is_female = no
						gender_equality_trigger = yes
					}
					is_heir = no
					block_general_event_trigger = no
					NOT = { has_minor_title = title_commander }
					has_epidemic = no
					is_ill = no
					NOT = { has_severe_disability_trigger = yes }
					can_press_claims_trigger = yes

					NOT = { has_character_flag = wants_to_travel_0 }
					NOT = { has_character_flag = wants_to_travel_1 }
					NOT = { has_character_flag = wants_to_travel_2 }
					NOT = { has_character_flag = originated_from_chinese_court }
				}
				save_event_target_as = back_up_target_1
				set_character_flag = wants_to_travel_1
			}
		}

        #Find a suitable second back-up for the journey... (preferably a child who's not an heir, otherwise a grown-up un-landed child, and in worst case, some random person at court)
        random_courtier = {
            limit = {
				is_child_of = ROOT
                NOT = { is_heir = ROOT }

                is_ruler = no
				in_command = no
				NOT = { has_minor_title = title_triarch }
				NOT = { culture_group = event_target:the_protector_general }
				OR = {
					is_female = no
					gender_equality_trigger = yes
				}
				is_heir = no
				block_general_event_trigger = no
				NOT = { has_minor_title = title_commander }
				has_epidemic = no
				is_ill = no
				NOT = { has_severe_disability_trigger = yes }
				can_press_claims_trigger = yes

                NOT = { has_character_flag = wants_to_travel_0 }
                NOT = { has_character_flag = wants_to_travel_1 }
                NOT = { has_character_flag = wants_to_travel_2 }
                NOT = { has_character_flag = originated_from_chinese_court }
            }
			save_event_target_as = back_up_target_2
            set_character_flag = wants_to_travel_2
        }
		if = {
			limit = { NOT = { event_target:back_up_target_2 = { always = yes } } }
			 random_courtier = {
				limit = {
					is_close_relative = ROOT
					NOT = { is_heir = ROOT }

					is_ruler = no
					in_command = no
					NOT = { has_minor_title = title_triarch }
					NOT = { culture_group = event_target:the_protector_general }
					OR = {
						is_female = no
						gender_equality_trigger = yes
					}
					is_heir = no
					block_general_event_trigger = no
					NOT = { has_minor_title = title_commander }
					has_epidemic = no
					is_ill = no
					NOT = { has_severe_disability_trigger = yes }
					can_press_claims_trigger = yes

					NOT = { has_character_flag = wants_to_travel_0 }
					NOT = { has_character_flag = wants_to_travel_1 }
					NOT = { has_character_flag = wants_to_travel_2 }
					NOT = { has_character_flag = originated_from_chinese_court }
				}
				save_event_target_as = back_up_target_2
				set_character_flag = wants_to_travel_2
			}
		}
		if = {
			limit = { NOT = { event_target:back_up_target_2 = { always = yes } } }
			 random_courtier = {
				limit = {
					is_ruler = no
					in_command = no
					NOT = { has_minor_title = title_triarch }
					NOT = { culture_group = event_target:the_protector_general }
					OR = {
						is_female = no
						gender_equality_trigger = yes
					}
					is_heir = no
					block_general_event_trigger = no
					NOT = { has_minor_title = title_commander }
					has_epidemic = no
					is_ill = no
					NOT = { has_severe_disability_trigger = yes }
					can_press_claims_trigger = yes

					NOT = { has_character_flag = wants_to_travel_0 }
					NOT = { has_character_flag = wants_to_travel_1 }
					NOT = { has_character_flag = wants_to_travel_2 }
					NOT = { has_character_flag = originated_from_chinese_court }
				}
				save_event_target_as = back_up_target_2
				set_character_flag = wants_to_travel_2
			}
		}
        set_character_flag = is_sending_someone_to_china
    }

    option = {
        name = EVTOPTA_JD_10011
		ai_chance = {
			factor = 100

			modifier = {
				factor = 2
				opinion = { who = FROM value = 20 }
			}
			modifier = {
				factor = 2
				opinion = { who = FROM value = 50 }
			}
			modifier = {
				factor = 2
				opinion = { who = FROM value = 80 }
			}
			modifier = {
				factor = 0.5
				NOT = { opinion = { who = FROM value = -20 } }
			}
			modifier = {
				factor = 0.5
				NOT = { opinion = { who = FROM value = -50 } }
			}
			modifier = {
				factor = 0.5
				NOT = { opinion = { who = FROM value = -80 } }
			}
		}
        custom_tooltip = { text = EVTOPTA_JD_10011_TT }

		wealth = -50
        event_target:adventurous_spirit = {
            #show_scope_change = no
			add_trait = wikid
            hidden_effect = { character_event = { id = JD.10012 days = 200 random = 160 } }
        }
    }

    option = {
        name = EVTOPTB_JD_10011
		ai_chance = {
			factor = 25

			modifier = {
				factor = 2
				opinion = { who = event_target:back_up_target_1 value = 20 }
			}
			modifier = {
				factor = 2
				opinion = { who = event_target:back_up_target_1 value = 50 }
			}
			modifier = {
				factor = 2
				opinion = { who = event_target:back_up_target_1 value = 80 }
			}
			modifier = {
				factor = 0
				NOT = { opinion = { who = event_target:back_up_target_1 value = -20 } }
			}
		}
        custom_tooltip = { text = EVTOPTB_JD_10011_TT }

		wealth = -50
        event_target:back_up_target_1 = {
            #show_scope_change = no
            add_trait = wikid
            save_event_target_as = adventurous_spirit
            hidden_effect = { character_event = { id = JD.10012 days = 200 random = 160 } }
        }
        trigger = {
            event_target:back_up_target_1 = { always = yes }
        }
    }

    option = {
        name = EVTOPTC_JD_10011
		ai_chance = {
			factor = 25

			modifier = {
				factor = 2
				opinion = { who = event_target:back_up_target_2 value = 20 }
			}
			modifier = {
				factor = 2
				opinion = { who = event_target:back_up_target_2 value = 50 }
			}
			modifier = {
				factor = 2
				opinion = { who = event_target:back_up_target_2 value = 80 }
			}
			modifier = {
				factor = 0
				NOT = { opinion = { who = event_target:back_up_target_2 value = -20 } }
			}
		}
        custom_tooltip = { text = EVTOPTC_JD_10011_TT }

		wealth = -50
        event_target:back_up_target_2 = {
            #show_scope_change = no
            add_trait = wikid
            save_event_target_as = adventurous_spirit
            hidden_effect = { character_event = { id = JD.10012 days = 200 random = 160 } }
        }

        trigger = {
            event_target:back_up_target_2 = { always = yes }
        }
    }

    option = {
        name = EVTOPTD_JD_10011
		ai_chance = {
			factor = 100

			modifier = {
				factor = 0.5
				wealth = 300
			}
			modifier = {
				factor = 0.5
				trait = kind
			}
			modifier = {
				factor = 0.5
				trait = charitable
			}
			modifier = {
				factor = 0.5
				trait = patient
			}
			modifier = {
				factor = 0.5
				trait = just
			}
			modifier = {
				factor = 0.5
				trait = honorable
			}
			modifier = {
				factor = 0.5
				trait = trusting
			}

			modifier = {
				factor = 2
				wealth < 50
			}
			modifier = {
				factor = 2
				trait = cruel
			}
			modifier = {
				factor = 2
				trait = greedy
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 2
				trait = arbitrary
			}
			modifier = {
				factor = 2
				trait = ruthless
			}
			modifier = {
				factor = 2
				trait = paranoid
			}
		}
        custom_tooltip = { text = EVTOPTD_JD_10011_TT }
        clr_character_flag = is_sending_someone_to_china
    }

    after = {
        hidden_effect = {
            any_courtier = {
                clr_character_flag = wants_to_travel_0
                clr_character_flag = wants_to_travel_1
                clr_character_flag = wants_to_travel_2
            }
            if = {
                limit = { has_character_flag = is_sending_someone_to_china }
                event_target:adventurous_spirit = {
                    force_host = event_target:the_protector_general
                }
                character_event = { id = JD.10020 days = 370 } #Fallback event (in case the traveler has died)
            }
        }
    }
}

#Delayed ping event and tombola for figuring out how the journey went... (fires for the traveler)
character_event = {
    id = JD.10012
	has_dlc = "Jade Dragon"
    hide_window = yes
    is_triggered_only = yes
    immediate = {
        event_target:the_protector_general_title = {
            holder_scope = {
                save_event_target_as = the_protector_general #in case the old one has died, resave
            }
        }

        #In case the liege who sent them away has died, send them back from where they came anyway...
        if = {
            limit = { NOT = { FROM = { is_alive = yes } } }
            event_target:original_court_province_target = {
                owner = {
                    save_event_target_as = new_story_owner
                    ROOT = { #moves ROOT to the new host
                    	force_host = PREV
                    	move_character = PREV
                    }
                }
            }
        }
        # If the old liege is still alive... (most often the case, we assume)!
        if = {
            limit = { FROM = { is_alive = yes } }
            force_host = FROM
        }

        random_list = { #random outcomes for the traveler...
            5 = {
                modifier = {
                    factor = 0.5
                    event_target:the_protector_general = { war = yes }
                }
                modifier = {
                    factor = 1.1
                    has_pleasant_trait_trigger = yes
                }
                modifier = {
                    factor = 1.1
                    has_pleasant_personality_trigger = yes
                }
                modifier = {
                    factor = 1.1
                    diplomacy = 10
                }
                modifier = {
                    factor = 1.1
                    diplomacy = 13
                }
                modifier = {
                    factor = 1.1
                    diplomacy = 15
                }
                modifier = {
                    factor = 1.1
                    diplomacy = 17
                }
                modifier = {
                    factor = 1.1
                    diplomacy = 20
                }
                modifier = {
                    factor = 1.1
                    stewardship = 10
                }
                modifier = {
                    factor = 1.1
                    stewardship = 15
                }
                modifier = {
                    factor = 1.1
                    stewardship = 20
                }
                modifier = {
                    factor = 1.2
                    reverse_opinion = { who = event_target:the_protector_general value = 20 }
                }
                modifier = {
                    factor = 1.2
                    reverse_opinion = { who = event_target:the_protector_general value = -20 }
                }

                if = {
                    limit = { NOT = { FROM = { is_alive = yes } } }
                    event_target:new_story_owner = { character_event = { id = JD.10013 } } #great
                }
                if = {
                    limit = { FROM = { is_alive = yes } }
                    FROM = { character_event = { id = JD.10013 } } #great
                }

                trigger = {
                    is_alive = yes
                }
            }
            10 = {
                modifier = {
                    factor = 0.5
                    event_target:the_protector_general = { war = yes }
                }
                modifier = {
                    factor = 1.1
                    diplomacy = 10
                }
                modifier = {
                    factor = 1.1
                    diplomacy = 15
                }
                modifier = {
                    factor = 1.1
                    diplomacy = 20
                }
                modifier = {
                    factor = 1.1
                    stewardship = 10
                }
                modifier = {
                    factor = 1.1
                    reverse_opinion = { who = event_target:the_protector_general value = 20 }
                }
                modifier = {
                    factor = 1.1
                    reverse_opinion = { who = event_target:the_protector_general value = -20 }
                }
                trigger = {
                    is_alive = yes
                }

                if = {
                    limit = { NOT = { FROM = { is_alive = yes } } }
                    event_target:new_story_owner = { character_event = { id = JD.10014 } } #good
                }
                if = {
                    limit = { FROM = { is_alive = yes } }
                    FROM = { character_event = { id = JD.10014 } } #good
                }

            }
            10 = {
                trigger = {
                    is_alive = yes
                }
                if = {
                    limit = { NOT = { FROM = { is_alive = yes } } }
                    event_target:new_story_owner = { character_event = { id = JD.10015 } } #decent
                }
                if = {
                    limit = { FROM = { is_alive = yes } }
                    FROM = { character_event = { id = JD.10015 } } #decent
                }

            }
            10 = {
                modifier = {
                    factor = 1.5
                    event_target:the_protector_general = { war = yes }
                }
                modifier = {
                    factor = 0.7
                    has_top_tier_education_trait_trigger = yes
                }
                modifier = {
                    factor = 1.1
                    NOT =  { reverse_opinion = { who = event_target:the_protector_general value = 0 } }
                }
                modifier = {
                    factor = 1.1
					NOT = { reverse_opinion = { who = event_target:the_protector_general value = -20 } }
                }
                trigger = {
                    is_alive = yes
                }

                if = {
                    limit = { NOT = { FROM = { is_alive = yes } } }
                    event_target:new_story_owner = { character_event = { id = JD.10016 } } #bad
                }
                if = {
                    limit = { FROM = { is_alive = yes } }
                    FROM = { character_event = { id = JD.10016 } } #bad
                }
            }
            5 = {
                modifier = {
                    factor = 1.5
                    event_target:the_protector_general = { war = yes }
                }
                modifier = {
                    factor = 0.5
                    is_smart_trigger = yes
                }
                modifier = {
                    factor = 0.7
                    has_top_tier_education_trait_trigger = yes
                }
                modifier = {
                    factor = 1.1
                    is_dumb_trigger = yes
                }
                modifier = {
                    factor = 1.1
                    diplomacy < 10
                }
                modifier = {
                    factor = 1.1
                    diplomacy < 8
                }
                modifier = {
                    factor = 1.1
                    diplomacy < 5
                }
                modifier = {
                    factor = 1.1
                    diplomacy < 3
                }
                modifier = {
                    factor = 1.1
                    has_unattractive_trait_trigger = yes
                }
                modifier = {
                    factor = 1.1
                    is_unattractive_trigger = yes
                }
                modifier = {
                    factor = 1.1
                    NOT =  { reverse_opinion = { who = event_target:the_protector_general value = 0 } }
                }
                modifier = {
                    factor = 1.5
                    NOT = { reverse_opinion = { who = event_target:the_protector_general value = -20 } }
                }
                trigger = {
                    is_alive = yes
                }
                if = {
                    limit = { NOT = { FROM = { is_alive = yes } } }
                    event_target:new_story_owner = { character_event = { id = JD.10017 } } #terrible
                }
                if = {
                    limit = { FROM = { is_alive = yes } }
                    FROM = { character_event = { id = JD.10017 } } #terrible
                }
            }
            10 = { # They return with a new lover/spouse
                character_event = { id = JD.10021 } #Special case 1: ping event for creating new char

				modifier = {
                    factor = 3
                    has_ambition = obj_find_lover
                }
				modifier = {
                    factor = 2
                    has_ambition = obj_get_married
                }
                modifier = {
                    factor = 1.5
                    is_attractive_trigger = yes
                }
                modifier = {
                    factor = 1.5
                    has_attractive_trait_trigger = yes
                }
				modifier = {
                    factor = 0.66
                    has_unattractive_trait_trigger = yes
                }
                modifier = {
                    factor = 0.66
                    is_unattractive_trigger = yes
                }
                modifier = {
                    factor = 1.2
                    reverse_opinion = { who = event_target:the_protector_general value = 20 }
                }
                modifier = {
                    factor = 0.5
					NOT = { reverse_opinion = { who = event_target:the_protector_general value = -20 } }
                }

                trigger = {
                    is_alive = yes
                    is_married = no
                    NOT = { any_consort = { character = FROM } }
                    has_lover = no
					NOT = { trait = homosexual }
                }
            }
            3 = { #They return but want to go back
                modifier = {
                    factor = 1.1
                    has_disease_trigger = no
                }
                modifier = {
                    factor = 1.2
                    reverse_opinion = { who = event_target:the_protector_general value = 20 }
                }
                modifier = {
                    factor = 0.1
					NOT = { reverse_opinion = { who = event_target:the_protector_general value = -20 } }
                }

                trigger = {
                    is_alive = yes
                    is_landed = no
					NOT = { is_married = FROM }
					NOR = {
						has_ambition = obj_wants_landed_title
						has_ambition = obj_become_heir
					}
					NOT = { trait = content }
					NOT = { trait = craven }
                }

                if = {
                    limit = { NOT = { FROM = { is_alive = yes } } }
                    event_target:new_story_owner = { character_event = { id = JD.10019 } } #Special case 2
                }
                if = {
                    limit = { FROM = { is_alive = yes } }
                    FROM = { character_event = { id = JD.10019 } }  #Special case 2
                }
            }
        }
    }
}

character_event = { # Things went great
    id = JD.10013
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_10013
    picture = GFX_evt_whispers
    border = GFX_event_normal_frame_diplomacy
    is_triggered_only = yes

    immediate = {
        #Chance of returning with artifact
        random = {
            chance = 100
            modifier = {
                factor = 0
                any_artifact = { has_artifact_flag = chinese }
            }
            set_character_flag = chinese_traveler_artifact
            event_target:the_protector_general_title = {
				holder_scope = {
                    random_list = {
                        5 = {
                            add_artifact = jade_dragon
                            new_artifact = {
								set_artifact_flag = heirloom_@ROOT
                                transfer_artifact = {
                                    from = PREV
                                    to = ROOT
                                }
                                save_event_target_as = chinese_artifact
                            }
                        }
                        15 = {
                            add_artifact = chinese_dragon_amulet
                            new_artifact = {
								set_artifact_flag = heirloom_@ROOT
                                transfer_artifact = {
                                    from = PREV
                                    to = ROOT
                                }
                                save_event_target_as = chinese_artifact
                            }
                        }
                        40 = {
                            add_artifact = chinese_artwork
                            new_artifact = {
								set_name = "chinese_artwork_name"
                                transfer_artifact = {
                                    from = PREV
                                    to = ROOT
                                }
                                save_event_target_as = chinese_artifact
                            }
                        }
                        40 = {
                            add_artifact = chinese_calligraphy
                            new_artifact = {
								set_name = "chinese_calligraphy_name"
                                transfer_artifact = {
                                    from = PREV
                                    to = ROOT
                                }
                                save_event_target_as = chinese_artifact
                            }
                        }
                        40 = {
                            add_artifact = chinese_sculpture
                            new_artifact = {
								set_name = "chinese_sculpture_name"
                                transfer_artifact = {
                                    from = PREV
                                    to = ROOT
                                }
                                save_event_target_as = chinese_artifact
                            }
                        }
                        20 = {
                            add_artifact = chinese_ceremonial_robes
                            new_artifact = {
								set_artifact_flag = heirloom_@ROOT
                                transfer_artifact = {
                                    from = PREV
                                    to = ROOT
                                }
                                save_event_target_as = chinese_artifact
                            }
                        }
                        20 = {
                            trigger = {
                               ROOT = { has_education_martial_trigger = yes }
                            }
                            modifier = {
                                factor = 2
                                ROOT = { martial = 14 }
                            }
                            modifier = {
                                factor = 2
                                ROOT = { martial = 18 }
                            }
                            modifier = {
                                factor = 2
                                ROOT = { martial = 22 }
                            }
                            modifier = {
                                factor = 2
                                ROOT = { martial = 24 }
                            }
                            add_artifact = art_of_war
                            new_artifact = {
                                transfer_artifact = {
                                    from = PREV
                                    to = ROOT
                                }
                                save_event_target_as = chinese_artifact
                            }
                        }
                        20 = {
                            add_artifact = silk_shroud
                            new_artifact = {
								set_artifact_flag = heirloom_@ROOT
                                transfer_artifact = {
                                    from = PREV
                                    to = ROOT
                                }
                                save_event_target_as = chinese_artifact
                            }
                        }
                        15 = {
                            add_artifact = water_clock
                            new_artifact = {
								set_artifact_flag = heirloom_@ROOT
                                transfer_artifact = {
                                    from = PREV
                                    to = ROOT
                                }
                                save_event_target_as = chinese_artifact
                            }
                        }
                        15 = {
                            add_artifact = jian_sword
                            new_artifact = {
								set_artifact_flag = heirloom_@ROOT
                                transfer_artifact = {
                                    from = PREV
                                    to = ROOT
                                }
                                save_event_target_as = chinese_artifact
                            }
                        }
                        10 = {
                            add_artifact = classic_of_poetry
                            new_artifact = {
                                transfer_artifact = {
                                    from = PREV
                                    to = ROOT
                                }
                                save_event_target_as = chinese_artifact
                            }
                        }
                    }
                }
            }
        }
    }

    option = {
        name = EVTOPTA_JD_10013
		sound_effect = china_grace_gain
        custom_tooltip = { text = EVTOPTA_JD_10013_TT }
        FROM = {
			random_list = {
				33 = {
				}
				33 = {
					trigger = {
						NOT = { trait = proud }
						NOT = { trait = humble }
						NOT = { personality_traits = 6 }
					}
					add_trait = proud
				}
				33 = {
					trigger = {
						trait = humble
					}
					remove_trait = humble
				}
				33 = {
					trigger = {
						NOT = { trait = brave }
						NOT = { trait = craven }
						NOT = { personality_traits = 6 }
					}
					add_trait = brave
				}
			}
        }
        wealth = 25
        if = {
            limit = { has_character_flag = chinese_traveler_artifact }
            tooltip = {
                event_target:chinese_artifact = {
                    show_scope_change = no
                    transfer_artifact = {
                        to = ROOT
                        from = FROM
                    }
                }
            }
            clr_character_flag = chinese_traveler_artifact
        }
        prestige = 50
        hidden_effect = { FROM = { remove_trait = wikid } }
        clr_character_flag = is_sending_someone_to_china
    }
}
character_event = { # Things went good
    id = JD.10014
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_10014
    picture = GFX_evt_feast
    border = GFX_event_normal_frame_diplomacy
    is_triggered_only = yes

    option = {
        name = EVTOPTA_JD_10014
		sound_effect = china_grace_gain
        prestige = 25
        FROM = {
			if = {
				limit = {
					NOT = { trait = patient }
					NOT = { trait = wroth }
					NOT = { personality_traits = 6 }
				}
				random = { chance = 50 add_trait = patient }
			}
        }
        hidden_effect = { FROM = { remove_trait = wikid } }
        clr_character_flag = is_sending_someone_to_china
    }
}
character_event = { # Things went decently
    id = JD.10015
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_10015
    picture = GFX_evt_recieve_letter
    border = GFX_event_normal_frame_diplomacy
    is_triggered_only = yes

    option = {
        name = EVTOPTA_JD_10015
		sound_effect = china_grace_gain
        prestige = 10
        hidden_effect = { FROM = { remove_trait = wikid } }
        clr_character_flag = is_sending_someone_to_china
    }
}
character_event = { # Things went bad
    id = JD.10016
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_10016
    picture = GFX_evt_quarrel
    border = GFX_event_normal_frame_diplomacy
    is_triggered_only = yes

    option = {
        name = EVTOPTA_JD_10016
        prestige = -25
        FROM = {
			if = {
				limit = {
					NOT = { trait = stressed }
				}
				random = { chance = 50 add_trait = stressed }
			}
        }
        hidden_effect = { FROM = { remove_trait = wikid } }
        clr_character_flag = is_sending_someone_to_china
    }
}
character_event = { # Things went terribly
    id = JD.10017
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_10017
    picture = GFX_evt_quarrel
    border = GFX_event_normal_frame_diplomacy
    is_triggered_only = yes

    option = {
        name = EVTOPTA_JD_10017
        custom_tooltip = { text = EVTOPTA_JD_10017_TT }
        prestige = -50
        FROM = {
			random_list = {
				33 = {
				}
				33 = {
					trigger = {
						NOT = { trait = shy }
						NOT = { trait = gregarious }
						NOT = { personality_traits = 6 }
					}
					add_trait = shy
				}
				33 = {
					trigger = {
						trait = gregarious
					}
					remove_trait = gregarious
				}
				33 = {
					trigger = {
						NOT = { trait = depressed }
					}
					add_trait = depressed
				}
			}
        }
        hidden_effect = { FROM = { remove_trait = wikid } }
        clr_character_flag = is_sending_someone_to_china
    }
}

#Ping event for Special case 1
character_event = {
    id = JD.10021
	has_dlc = "Jade Dragon"
    hide_window = yes
    is_triggered_only = yes

    immediate = {
		event_target:the_protector_general = {
			capital_scope = { save_event_target_as = lover_culture }
		}

        if = {
            limit = { is_female = yes }
            create_character = {
                age = 25
                dynasty = actually_culture
                religion = event_target:lover_culture
                culture = event_target:lover_culture
                female = no
                health = 6
                random_traits = yes
                historical = yes
            }
        }
        if = {
            limit = { is_female = no }
            create_character = {
                age = 25
                dynasty = actually_culture
                religion = event_target:lover_culture
                culture = event_target:lover_culture
                female = yes
                health = 6
                random_traits = yes
                historical = yes
            }
        }
        new_character = {
            save_event_target_as = new_found_lover
            add_lover = ROOT
        }
        add_ambition = obj_get_married

        if = {
            limit = { NOT = { FROMFROM = { is_alive = yes } } }
            event_target:new_story_owner = { character_event = { id = JD.10018 } } #Special case 2
        }
        if = {
            limit = { FROMFROM = { is_alive = yes } }
            FROMFROM = { character_event = { id = JD.10018 } }  #Special case 2
        }
    }
}

character_event = { # Special case 1 - The courtier you sent away to China has returned with a lover/spouse
    id = JD.10018
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_10018
    picture = GFX_evt_scandal
    border = GFX_event_normal_frame_diplomacy
    is_triggered_only = yes
    hide_new = yes

    option = { #They bring someone home
        name = EVTOPTA_JD_10018
		sound_effect = china_grace_gain
        custom_tooltip = { text = EVTOPTA_JD_10018_TT }

        #moves the lover to your court (and leaves a flag for later marriage hook-in)...
        event_target:new_found_lover = {
            move_character = ROOT
            set_character_flag = gets_to_stay
        }

        hidden_effect = { FROM = { remove_trait = wikid } }
        prestige = 50
    }
    option = { #We don't have room for strangers
        name = EVTOPTB_JD_10018
		sound_effect = china_grace_gain
        hidden_effect = { FROM = { remove_trait = wikid } }

        reverse_opinion = {
            who = FROM
            modifier = opinion_sent_my_lover_away
            years = 20
        }

        if = { limit = { FROM = { trait = stressed } } FROM = { add_trait = depressed } } #if they are already stressed, this depressed them

        event_target:new_found_lover = {
            set_character_flag = has_to_leave
            hidden_effect = { move_character = event_target:the_protector_general }
        }
        prestige = 50
    }

    after = {
        clr_character_flag = is_sending_someone_to_china
    }
}
character_event = { # Special case 2 - The courtier you sent away to China has returned but wants to go back
    id = JD.10019
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_10019
    picture = GFX_evt_son_asking_father
    border = GFX_event_normal_frame_diplomacy
    is_triggered_only = yes

    option = { #They go back to China, forever
        name = {
            text = EVTOPTA_JD_10019
            trigger = {
                NOR = {
                    trait = lunatic
                    is_dumb_trigger = yes
                    trait = poet
                    trait = kind
                }
            }
        }
        name = {
            text = EVTOPTA_JD_10019_lunatic
            trigger = { trait = lunatic }
        }
        name = {
            text = EVTOPTA_JD_10019_imbecile
            trigger = { is_dumb_trigger = yes }
        }
        name = {
            text = EVTOPTA_JD_10019_poet
            trigger = { OR = { trait = poet trait = kind } }
        }
		sound_effect = china_grace_gain

        if = { #Do they have family?
            limit = {
                FROM = {
                    OR = {
                        any_spouse = {
							is_ruler = no
							is_alive = yes
						}
                        any_child = {
                            NOT = { is_child_of = ROOT }
                            is_adult = no
							is_ruler = no
							same_liege = PREV
                        }
                    }
                }
            }
            custom_tooltip = { text = EVTOPTA_JD_10019_TT_family } #Explains that they will take their family with them
        }
        if = { #Are they single and without children?
            limit = {
                FROM = {
					NOR = {
                        any_spouse = {
							is_ruler = no
							is_alive = yes
						}
                        any_child = {
                            NOT = { is_child_of = ROOT }
                            is_adult = no
							is_ruler = no
							same_liege = PREV
                        }
                    }
                }
            }
            custom_tooltip = { text = EVTOPTA_JD_10019_TT_solo } # Explains that they'll just go on their own
        }


        FROM = {
            hidden_effect = {
                remove_trait = wikid

                move_character = event_target:the_protector_general

				any_spouse = { # They take their spouse with them
					limit = {
						is_ruler = no
						is_alive = yes
					}
					move_character = event_target:the_protector_general
				}

				any_child = { #They take any children with them
					limit = {
						NOT = { is_child_of = ROOT }
						is_adult = no
						is_ruler = no
						same_liege = PREV
					}
					move_character = event_target:the_protector_general
				}
            }
        }
        prestige = 100
        if = {
            limit = { FROM = { is_child_of = ROOT } }
            set_character_flag = let_child_go_to_china #Potential hook-in for future events?
        }
    }

    option = { #They are angry
        name = EVTOPTB_JD_10019
		sound_effect = china_grace_gain
        prestige = 50
        hidden_effect = {  FROM = { remove_trait = wikid } }
        reverse_opinion = {
            who = FROM
            modifier = opinion_angry
            years = 15
        }
    }

    option = { #They will get over it
        name = EVTOPTC_JD_10019
        prestige = 50
        hidden_effect = { FROM = { remove_trait = wikid } }

        reverse_opinion = {
            who = FROM
            modifier = opinion_disgruntled
            years = 15
        }

        tooltip_info = diplomacy
        trigger = { diplomacy = 15 }
    }

    option = { #Plead to them from the bottom of your heart
        name = EVTOPTD_JD_10019
        custom_tooltip = { text = EVTOPTD_JD_10019_TT }
		sound_effect = china_grace_gain

        prestige = 50
        hidden_effect = { FROM = { remove_trait = wikid } }

        reverse_opinion = {
            who = FROM
            modifier = opinion_feels_appreciated
            years = 10
        }

        tooltip_info = yes
        trigger = {
            reverse_opinion = {
                who = FROM
                value = 60
            }
        }
    }
    after = {
        clr_character_flag = is_sending_someone_to_china
    }
}

character_event = { # Fallback (in case the traveler died)
    id = JD.10020
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_10020
    picture = GFX_evt_recieve_letter
    border = GFX_event_normal_frame_diplomacy
    is_triggered_only = yes

    trigger = {
        has_character_flag = is_sending_someone_to_china
        event_target:adventurous_spirit = {
            NOT = { is_alive = yes }
        }
    }

    option = {
        name = EVTOPTA_JD_10020
        custom_tooltip = { text = EVTOPTA_JD_10020_TT }
        clr_character_flag = is_sending_someone_to_china
    }
}

################
# Suzerain dies, inform tributary relationship ends
character_event = {
    id = JD.60015
    is_triggered_only = yes
    hide_window = yes
    only_rulers = yes

    trigger = {
        any_tributary = {
            ai = no
            is_tributary = { type = default }
        }
    }

    immediate = {
        any_tributary = {
            limit = {
                ai = no
                is_tributary = { type = default }
            }
            character_event = { id = JD.60016 }
        }
    }
}
character_event = {
    id = JD.60016
    desc = EVT_DESC_JD_60016
    picture = GFX_evt_bandits
    is_triggered_only = yes
    notification = yes
    option = { }
}
